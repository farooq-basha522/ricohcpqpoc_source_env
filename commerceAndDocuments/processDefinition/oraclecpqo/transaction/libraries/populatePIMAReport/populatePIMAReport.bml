// PIMA REPORT LIBRARY FUCTION- MS Products
// the purpose to generate Arraysets required to be populated in PIMA report document Template.
// CHG number CHG0078656
// Date of creation: January 05th 2023
// Attribute declaration.....
//code added by Rohit for CHG0086386 to calculate total dea revenue when there is variable escalation revenue
//code added by Rohit for CHG0086584 to trigger pricing approval for contract term less than 12 month


res = "";
L3ReviewEmailIds  = "" ;
L3ReviewLevelArray= string[];
FederalFlag = false;
GPMessageforFnF = "";
Months_ImplementationCost = 0.0;
contractTerm = 1;
termFactor = 1;
costOnlyTotal = 0.0;
totalRebateCost = 0.0;
year1MarginPercent = 0.0;
year2MarginPercent= 0.0;
year3MarginPercent= 0.0;
year4MarginPercent= 0.0;
year5MarginPercent= 0.0;
year6MarginPercent= 0.0;
year7MarginPercent= 0.0;
MSLaborTotalContract = 0.0;
totalContractRevenueY1= 0.0;
totalContractRevenueY2= 0.0;
totalContractRevenueY3= 0.0;
totalContractRevenueY4= 0.0;
totalContractRevenueY5= 0.0;
totalContractRevenueY6= 0.0;
totalContractRevenueY7= 0.0;
totalContractCostY1= 0.0;
totalContractCostY2= 0.0;
totalContractCostY3= 0.0;
totalContractCostY4= 0.0;
totalContractCostY5= 0.0;
totalContractCostY6= 0.0;
totalContractCostY7= 0.0;
MSTotalContractValue = "0.0";
totalRebateCostYear1 =0.0;
totalRebateCostYear2 = 0.0;
totalRebateCostYear3 = 0.0;
totalRebateCostYear4 =0.0;
totalRebateCostYear5 = 0.0;
totalRebateCostYear6 = 0.0;
totalRebateCostYear7 = 0.0;
SCItemValue = "";
itemtypeCategoryDict = dict("string");
firstMonthBillingArray= jsonarray();
MSTotalDealArray = jsonarray();
MSPIMAArray = jsonarray();
MPSPIMAArray= jsonarray();
ITSPIMAArray= jsonarray();
TASSPIMAArray= jsonarray();
VehiclePIMAArray= jsonarray();
TRACPIMAArray= jsonarray();
OtherSerPIMAArray= jsonarray();
PSPIMAArray= jsonarray();
mailRoomPIMAArray= jsonarray();
firstMonthBillingJson = json();
MSTotalDealJson= json();
MPSLaborPIMAJson= json();
MSLaborPIMAJson = json();
ITSLaborPIMAJson= json();
TASSLaborPIMAJson = json();
VehiclePIMAJson = json();
MailRoomPIMAJson = json();	
TRACPIMAJson = json();
otherServicesPIMAJson = json();
PSPIMAJson =json();
OtherSerNTPIMAArray=jsonarray();
otherServicesNTPIMAJson= json();
rebateTotalArray=jsonarray();
rebateTotalJson=json();
areaCostArray=jsonarray();
areaCostJson =json();
totalcostOnlyValueDonation = 0.0;
totalcostOnlyValueSignUp=0.0;
totalcostOnlyValueConsulting=0.0;
MSTotalDealRowListArray=string[];
firstMonthBillingRowListArray = string[];
MSTotalDealDict = dict("string");
totalMonthlyRevenue = 0.0;
totalMonthlyCost = 0.0;
totalMonthlyStandardCost = 0.0 ;
totalImplementationCostValue = 0.0;
totalMonthlyRevenueYear1 = 0.0;
totalMonthlyRevenueYear2 = 0.0;
totalMonthlyRevenueYear3 = 0.0;
totalMonthlyRevenueYear4 = 0.0;
totalMonthlyRevenueYear5 = 0.0;
totalMonthlyRevenueYear6 = 0.0;
totalMonthlyRevenueYear7 = 0.0;
totalImplementationCostYear1 = 0.0;
totalImplementationCostYear2 = 0.0;
totalImplementationCostYear3 = 0.0;
totalImplementationCostYear4 = 0.0;
totalImplementationCostYear5 = 0.0;
totalImplementationCostYear6 = 0.0;
totalImplementationCostYear7 = 0.0;
totalMonthlyCostYear1 = 0.0;
totalMonthlyCostYear2 = 0.0;
totalMonthlyCostYear3 = 0.0;
totalMonthlyCostYear4 = 0.0;
totalMonthlyCostYear5 = 0.0;
totalMonthlyCostYear6 = 0.0;
totalMonthlyCostYear7 = 0.0;

totalStandardCostGMYear1 = 0.0;
totalStandardCostGMYear2 = 0.0;
totalStandardCostGMYear3 = 0.0;
totalStandardCostGMYear4 = 0.0;
totalStandardCostGMYear5 = 0.0;
totalStandardCostGMYear6 = 0.0;
totalStandardCostGMYear7 = 0.0;
totalStandardCosGMContract = 0.0;

totalStandardCostMerginPerYear1 = 0.0;
totalStandardCostMerginPerYear2 = 0.0;
totalStandardCostMerginPerYear3 = 0.0;
totalStandardCostMerginPerYear4 = 0.0;
totalStandardCostMerginPerYear5 = 0.0;
totalStandardCostMerginPerYear6 = 0.0;
totalStandardCostMerginPerYear7 = 0.0;
StandardCostMarginPerTotalContract = 0.0;

totalMonthlyStandardCostYear1 = 0.0;
totalMonthlyStandardCostYear2 = 0.0;
totalMonthlyStandardCostYear3 = 0.0;
totalMonthlyStandardCostYear4 = 0.0;
totalMonthlyStandardCostYear5 = 0.0;
totalMonthlyStandardCostYear6 = 0.0;
totalMonthlyStandardCostYear7 = 0.0;


pricingThresholdBreachY1 = "";
pricingThresholdBreachY2 = "";
pricingThresholdBreachY3 = "";
pricingThresholdBreachY4 = "";
pricingThresholdBreachY5 = "";
pricingThresholdBreachY6 = "";
pricingThresholdBreachY7 = "";

totalDealcost1 =0.0;
totalDealcost2 =0.0;
totalDealcost3 =0.0;
totalDealcost4 =0.0;
totalDealcost5 =0.0;
totalDealcost6 =0.0;
totalDealcost7 =0.0;
totalMarginTotalContract = 0.0;
totalGMTotalContract= 0.0;
totaldealCostTotalContract= 0.0;
totaldealRecCostTotalContract= 0.0;
totaldealRevenueTotalContract= 0.0;
RebateCostTotalContract = 0.0;
totalContractRevenue = 0.0;
totalContractCost = 0.0;
totalContractGrossMargin = 0.0;
totalContractGrossMarginPercent = 0.0;	
totalDealUpfrontCost1 = 0.0;
totalGM1 =0.0;
totalGM2 =0.0;
totalGM3 =0.0;
totalGM4 =0.0;
totalGM5 =0.0;
totalMarginPercent1 = 0.0;
totalMarginPercent2 = 0.0;
totalMarginPercent3 = 0.0;
totalMarginPercent4 = 0.0;
totalMarginPercent5 = 0.0;
totalMarginPercent6 = 0.0;
totalMarginPercent7 = 0.0;
year1MSTotal = "0.0";
year2MSTotal = "0.0";
year3MSTotal = "0.0";
year4MSTotal = "0.0";
year5MSTotal = "0.0";
year6MSTotal = "0.0";
year7MSTotal = "0.0";
MSLaborYear6Val= 0.0;
MSLaborYear7Val= 0.0;
totalMSCost = 0.0;
totalMPSCost=0.0;
totalITScost=0.0;
totalTASSCost=0.0;
totalVehicleCost=0.0;
totalTRACCost=0.0;
totalOtherServicesCost=0.0;
totalPSCost=0.0;
totalMailroomCost=0.0;
totalMSRevenue=0.0;
totalMPSRevenue=0.0;
totalITSRevenue=0.0;
totalTASSRevenue=0.0;
totalVehicleRevenue=0.0;
totalTRACRevenue=0.0;
totalOtherServicesRevenue=0.0;
totalPSRevenue=0.0;
totalMailroomRevenue=0.0;
partArray = string[];
ItemTypeDict = dict("string");
itemtypeArray = string[];
PricingDict = dict("float");
year1Flag=false;
year2Flag = false;
year3Flag= false;
year4Flag=false;
year5Flag=false;
year6Flag=false;
year7Flag=false;
termFactorYear1 =1;
termFactorYear2 =1;
termFactorYear3 =1;
termFactorYear4 =1;
termFactorYear5 =1;
termFactorYear6 =1;
termFactorYear7 =1;
totalcostOnlyValueDonation = 0.0;
totalcostOnlyValueSignUp=0.0;
totalcostOnlyValueConsulting=0.0;
itemtype = "";
FirstMonthPaymentPIMA= 0;
FirstYearPIMAGP=0;

// REBATE Code block to calculate rebate Percentage or Monethly for customer specific rebate----------
rebatePrecentage= rebateValue_CustomerSpecific_t;		
if(rebateGPOThirdparty_t == ""){
	rebatePrecentage= 0.0;
}
rebateDollarMonthly = 0.0;
if(rebateType_t == "directPayment" AND rebateValueOption_t == "rebateValue"){
		
	if(rebateApplied_t == "monthly"){
	rebateDollarMonthly = rebateValueDollar_t;
	}elif(rebateApplied_t == "quarterly"){
	rebateDollarMonthly = rebateValueDollar_t/3;
	}elif(rebateApplied_t == "semiAnnual"){
	 rebateDollarMonthly = rebateValueDollar_t/6;	
	}elif(rebateApplied_t == "annual"){
	 rebateDollarMonthly = rebateValueDollar_t/12;
	}else{
	 rebateDollarMonthly = rebateValueDollar_t;	
	}
	
}elif(rebateValueOption_t == "rebatePercent" AND rebateGPOThirdparty_t == ""){	
	rebatePrecentage=rebateValue_t;
}
// End of customer specific rebate code block----------------------
		
containsPSInMSItems = false;
// transaction line Process loop to get all configured parts , those are used to query BOM Defination for item type
for line in transactionLine{	
	if(line._part_number <> ""){
		append(partArray,line._part_number);
		append(itemtypeArray,line.type_l);
		//START - Defect 17781 Checking Whether MS lines present or NOT
		if(line.includeInMS_l == true AND NOT containsPSInMSItems){
			containsPSInMSItems = true;
		}
		//END - Defect 17781 Checking Whether MS lines present or NOT
	}
}
				
// get item type for getting solution item catagories
itemTypeSet = bmql("select * from RAC_ITEM_TYPE where ItemType in $itemtypeArray");
for eachValue in itemTypeSet{
	put(itemtypeCategoryDict,get(eachValue,"ItemType"),get(eachValue,"ProcessGroup"));
	
}
//START - Defect 17781 Checking Whether MS lines present or NOT
containsMSItems = false;
processGroupArray = values(itemtypeCategoryDict);
if(findinarray(processGroupArray,"MS") <> -1 OR containsPSInMSItems){
	containsMSItems = true;
}
//END - Defect 17781 Checking Whether MS lines present or NOT
		
// query to bom item def table to get item type which required to catagorize the parts into components 

bomRecordSet=bmql("select ItemType,PartNumber from Oracle_BomItemDef2 where PartNumber in $partArray");
		
for eachData in bomRecordSet{
	
	put(ItemTypeDict,get(eachData,"PartNumber"),get(eachData,"ItemType"));
}
if(termMonths_t == "Other"){
	
contractTerm = contractOtherTerm_t;
}elif(isnumber(termMonths_t)){
	
contractTerm = 	atoi(termMonths_t);
}


// Calculate Yearwise Term Factor to handle odd Month scenarios e.g. 28 month.


year1Flag = true;

termFactorYear1 = contractTerm;

if(termFactorYear1 == 0.0 OR contractTerm >= 12){
	termFactorYear1 =12;
}
if(contractTerm > 12){
	year2Flag = true;
	 if(contractTerm <= 24){
		termFactorYear2 = fmod(contractTerm, 12);

		if(termFactorYear2 == 0.0){
			termFactorYear2 =12;
		}
	 }elif(contractTerm > 24){
		termFactorYear2 =12; 
	 }
}
if(contractTerm > 24){
	year3Flag = true;
	if(contractTerm <= 36){
		termFactorYear3 = fmod(contractTerm, 12);

		if(termFactorYear3 == 0.0){
			termFactorYear3 =12;
		}
	}elif(contractTerm > 36){
	termFactorYear3 =12;	
	}
}
if(contractTerm > 36){
	year4Flag = true;
	if(contractTerm <= 48){
		termFactorYear4 = fmod(contractTerm, 12);

		if(termFactorYear4 == 0.0){
			termFactorYear4 =12;
		}
	}elif(contractTerm > 48){
	termFactorYear4 =12;	
	}
}
if(contractTerm > 48){
		year5Flag = true;
	if(contractTerm <= 60){
		termFactorYear5 = fmod(contractTerm, 12);

		if(termFactorYear5 == 0.0){
			termFactorYear5 =12;
		}
	}elif(contractTerm > 60){
	termFactorYear5 =12;	
	}
	
}
if(contractTerm > 60){
		year6Flag = true;
	if(contractTerm <= 72){
		termFactorYear6 = fmod(contractTerm, 12);

		if(termFactorYear6 == 0.0){
			termFactorYear6 =12;
		}
	}elif(contractTerm > 72){
	termFactorYear6 =12;	
	}
	
}
if(contractTerm > 72){
		year7Flag = true;
	if(contractTerm <= 84){
		termFactorYear7 = fmod(contractTerm, 12);

		if(termFactorYear7 == 0.0){
			termFactorYear7 =12;
		}
	}elif(contractTerm > 84){
	termFactorYear7 =12;	
	}
	
}


// query to PIMA data table to generate rows in the each section of the table/Array.
resultSet = bmql("select * from RAC_MS_PIMA");

// the below loop to get the sections for MS Deals and first month billing in array.
for eachData in resultSet{
	
	if(get(eachData,"SectionName") == "MS Total Deal Section"){
		
	append(MSTotalDealRowListArray,get(eachData,"Item"));
		
	} 
	
	if(get(eachData,"SectionName") == "First Month Billing"){
		
	append(firstMonthBillingRowListArray,get(eachData,"Item"));	
		
	}
	
}

// Line process loop to read the line item details (Pricing of each line - Sales cost/ Ext price.).
itemTypeArray= string[];
for line in transactionLine{
tempRevenuevalue = 0.0;
totalMarginValue = 0.0;
totalMarginPercent = 0.0;
totalContractCost = 0.0;
processGroup ="";
itemtype = "";
	if(line._model_name == "Ricoh Managed Services"){
		MSFlag = true;
		costOnlyDecription = getconfigattrvalue(line._document_number,"costOnly_description");
		costOnlyValues = getconfigattrvalue(line._document_number,"costOnly_cost");
		
		if(find(costOnlyValues,"$,$") <> -1){
			tempCostOnlyVal = split(costOnlyValues,"$,$");
			tempCostOnlyDesc = split(costOnlyDecription,"$,$");
			count = 0;
			for eachVal in tempCostOnlyVal{
				if(isnumber(eachVal)){
				
					 costOnlyTotal = costOnlyTotal + atof(eachVal);
					
					if(tempCostOnlyDesc[count]=="Consultation Fee"){

						totalcostOnlyValueConsulting = totalcostOnlyValueConsulting + atof(eachVal);
						
					}elif(tempCostOnlyDesc[count]=="Donations"){
						totalcostOnlyValueDonation = totalcostOnlyValueDonation + atof(eachVal);
						
						
					}elif(tempCostOnlyDesc[count]=="Sign-on Bonus"){

						totalcostOnlyValueSignUp = totalcostOnlyValueSignUp + atof(eachVal);
						
					}
					
						
				}
				count =  count + 1;
			}
		}elif(isnumber(costOnlyValues)){
			
			 costOnlyTotal = costOnlyTotal + atof(costOnlyValues);
			if(costOnlyDecription =="Consultation Fee"){

			totalcostOnlyValueConsulting = totalcostOnlyValueConsulting + atof(costOnlyValues);
						
			}elif(costOnlyDecription =="Donations"){					

				totalcostOnlyValueDonation = totalcostOnlyValueDonation + atof(costOnlyValues);
				
			}elif(costOnlyDecription =="Sign-on Bonus"){

				totalcostOnlyValueSignUp = totalcostOnlyValueSignUp + atof(costOnlyValues);
			}
		}
			
			
		put(MSTotalDealDict,"Total Consulting Fees Cost"+"_Year1",string(totalcostOnlyValueConsulting));
		put(MSTotalDealDict,"Total Donations Cost"+"_Year1",string(totalcostOnlyValueDonation));
		 
		put(MSTotalDealDict,"Total Sign On Cost"+"_Year1",string(totalcostOnlyValueSignUp));
		
		
		put(MSTotalDealDict,"Total Consulting Fees Cost"+"_Total Contract",string(totalcostOnlyValueConsulting));
		put(MSTotalDealDict,"Total Donations Cost"+"_Total Contract",string(totalcostOnlyValueDonation));
		 
		put(MSTotalDealDict,"Total Sign On Cost"+"_Total Contract",string(totalcostOnlyValueSignUp));

		put(PricingDict,"Cost Only Details_Month1_COST",costOnlyTotal);
		put(PricingDict,"Cost Only Details_Month1_REV",0.0);
		put(PricingDict,"Cost Only Details_Month1_MG",0.0);
		
		put(MSTotalDealDict,"Total Deal Upfront Sales Cost"+"_Year1",string(costOnlyTotal));
		
		put(MSTotalDealDict,"Total Deal Upfront Sales Cost"+"_Total Contract",string(costOnlyTotal));
		totalDealUpfrontCost1 = costOnlyTotal;
	}elif(line._part_number <> ""){
		
			//added by Namrata to exclude MPS lines Defect ID : 20835
			itemTypeArray = string[];
			append(itemTypeArray, line.type_l);
			processGroupDict = util.getProcessGroup(itemTypeArray);
			print "---49000--start of loop--";
			print line._part_number;
			print line._document_number;
			print processGroupDict;
			print line.type_l;
			
			if(containskey(processGroupDict, line.type_l)){
			processGroup = get(processGroupDict, line.type_l);
			}
			print processGroup;
			print "-------------";
			
		//added by Namrata to exclude MPS lines Defect ID : 20835
		itemtype =get(ItemTypeDict,line._part_number);
		
		if(not(isnull(get(itemtypeCategoryDict,line.type_l)))){
		SCItemValue = get(itemtypeCategoryDict,line.type_l);
		}
		
		if(SCItemValue == "SC" AND line.includeInMS_l){
			
			itemtype = "PS in MS";
		}
		//process group condition added by Namrata to ignore MPS Lines	Defect ID : 20835
		print "506 condition----";
		
		print itemtype;
		print processGroup;
		//print ((find(itemtype,"PS in MS") <> -1 AND line.includeInMS_l) OR (find(itemtype,"PS in MS") == -1 AND SCItemValue <> "SC" AND processGroup == "MS"));
		if((itemtype<>""  AND NOT ISNULL(itemtype)) AND ((find(itemtype,"PS in MS") <> -1 AND line.includeInMS_l) OR (find(itemtype,"PS in MS") == -1 AND SCItemValue <> "SC" AND processGroup == "MS"))){
			totalMonthlyRevenue = totalMonthlyRevenue + line.extNetPrice_l;
			
			print "line.extNetPrice_l- inside commercial loop---";
			
			print line.extNetPrice_l;
			totalMonthlyCost = totalMonthlyCost + (line._price_quantity *line.unitSalesCost_l);
			totalMonthlyStandardCost = totalMonthlyStandardCost + (line._price_quantity *line.unitCost_l);
			//Print "******";print itemtype; print line.implementationCost_l;

			//START_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata.
			if(itemtype == "MS Labor" OR itemtype == "MPS Labor"OR itemtype == "3rd Party" OR itemtype == "Vehicle" OR itemtype == "TRAC" OR  itemtype == "Mailroom Solutions" OR itemtype == "Ancillary Cost"){
				/*impCostF  = 0; impCostVariable  = "";
				if(itemtype == "Ancillary Cost"){
					 implementRecords = BMQL("select Category_Value from RAC_MS_UPLIFT where Category_Name = 'IMPLEMENT_COST_Variable'");
					 for eachImp in implementRecords {
					 impCostVariable = get(eachImp ,"Category_Value");
					 }
					 if(impCostVariable  <> ""){
					 impCostF  = atof(impCostVariable);

					 totalImplementationCostValue  =  totalImplementationCostValue +( line.unitSalesCost_l* impCostF * 12 *line._price_quantity);
					// Print "******";print itemtype; print line.unitSalesCost_l* impCostF * 12 *line._price_quantity ;

					 }
				}
				else{*/
						//Print "******";print itemtype; print line.implementationCost_l ;

					totalImplementationCostValue = totalImplementationCostValue + (line._price_quantity *line.implementationCost_l);
				//}


			}
			//END_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata.

		}
		//Area cost type items having different item type in BOM DEF and different naming required in PIMA hence hardcoded
		if(itemtype == "Ancillary Cost"){
				itemtype = "Phone/PC";
		}
		year2MarginPercent = 0.0;
		year3MarginPercent = 0.0;
		year4MarginPercent= 0.0;
		year5MarginPercent= 0.0;
		year6MarginPercent= 0.0;
		year7MarginPercent= 0.0;
		year1MarginPercent= 0.0;
		IncreamentalCostTotal =0.0;
		tempImplementationCostVal =  0.0;
		IncreamentalCostTotal = 0.0;
		for eachData in resultSet{
			totalContractCost = 0.0;
			totalContractRevenue = 0.0;
			totalContractGrossMargin = 0.0;
			totalMarginValue = 0.0;
			totalContractGrossMarginPercent = 0.0;
	
		if(itemtype<>"" AND NOT ISNULL(itemtype) ){
		//process group condition added by Namrata to ignore MPS Lines	Defect ID : 20835
		//print eachData;
			if((find(itemtype,"3rd Party") <> -1 AND get(eachData,"SectionName")== itemtype AND processGroup == "MS") OR (find(itemtype,"3rd Party") == -1 AND find(get(eachData,"SectionName"),itemtype) <> -1 AND find(get(eachData,"Item"),itemtype) <> -1 AND processGroup <> "MPS") OR find(get(eachData,"SectionName"),"Rebate(s)") <> -1){
				tempDescriptionCost = "";
				tempDescriptionRev = "";
				ItemDescriptionTempGM = "";
				ItemDescriptionTempRev = "";
				totalDeltaIncreamentalRevenueYear1 = 0.0;
				totalIncreamentalRevenueForNextYear = 0.0;
				totalIncreamentalCostForNextYear = 0.0;
				totalDeltaIncreamentalCostYear1=0.0;
				totalREV_Y1=0.0;
				totalCOST_Y1=0.0;
				itemDescription =get(eachData,"Item");
				//print "itemDescription--561--";
				//print itemDescription;
				
				if((param1 == "" AND find(itemDescription,"Standard Cost") == -1) OR (param1 == "Price Analyst")){
					
				// condition to filter Revenue Items of the each component from the data table.......
				if(find(itemDescription,"Revenue") <> -1){

					
				//Start_HYPERCARE-CR_CHG#0082000_CR#41_Description_by Namrata
				// changes done to retrieve Annual Escalation % per year if variable annual escalation flag is true
					annualEscalationVar = "";
					annualEscalationFloat = 0;
					if(containskey(PricingDict,itemDescription+"_Year1")){
					
						tempRevenuevalue = get(PricingDict,itemDescription+"_Year1");
						tempRevenuevalueWithoutTerm = tempRevenuevalue/termFactorYear1;
						tempRevenuevalue = tempRevenuevalue + line.extNetPrice_l*termFactorYear1;
						tempRevenuevalueWithoutTerm = tempRevenuevalueWithoutTerm + line.extNetPrice_l;
						put(PricingDict,itemDescription+"_Year1",tempRevenuevalue);
						totalContractRevenueY1 =tempRevenuevalue;

						if(variableAnnualRevenueEscalation_t == true){
							annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year1"));
							if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
							}
						}else{
							annualEscalationFloat = annualRevenueEscalation_t;
							}

						totalDeltaIncreamentalRevenueYear1 = (tempRevenuevalueWithoutTerm*annualEscalationFloat/100) ;
						totalIncreamentalRevenueForNextYear =  tempRevenuevalueWithoutTerm;
						}else{

						put(PricingDict,itemDescription+"_Year1",line.extNetPrice_l*termFactorYear1);
						totalContractRevenueY1=line.extNetPrice_l*termFactorYear1;
						
						if(variableAnnualRevenueEscalation_t == true){
							annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year1"));
							if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
							}
						}else{
							annualEscalationFloat = annualRevenueEscalation_t;
							}
						totalDeltaIncreamentalRevenueYear1 = (line.extNetPrice_l*annualEscalationFloat/100) ;
						totalIncreamentalRevenueForNextYear =  line.extNetPrice_l;
					}
				//print PricingDict;
					if(year2Flag){
						
						if(containskey(PricingDict,itemDescription+"_Year2")){
							tempRevenuevalue = get(PricingDict,ItemDescription+"_Year2");
							tempRevenuevalue = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear2;
							put(PricingDict,itemDescription+"_Year2",tempRevenuevalue);
							totalContractRevenueY2 = tempRevenuevalue;
							totalIncreamentalRevenueForNextYear = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1);
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year2"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
									annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
								}
							
							totalDeltaIncreamentalRevenueYear1 = totalIncreamentalRevenueForNextYear*annualEscalationFloat/100 ;
							
						}else{
						
							put(PricingDict,ItemDescription+"_Year2",(totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear2);
							
							totalContractRevenueY2 = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear2;
							 totalIncreamentalRevenueForNextYear = totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1;
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year2"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
						
							totalDeltaIncreamentalRevenueYear1 = totalIncreamentalRevenueForNextYear*annualEscalationFloat /100 ;
							
						}
					}
				
					if(year3Flag){
						if(containskey(PricingDict,ItemDescription+"_Year3")){
							
							tempRevenuevalue = get(PricingDict,ItemDescription+"_Year3");
							tempRevenuevalue = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear3;
							put(PricingDict,itemDescription+"_Year3",tempRevenuevalue);
							totalContractRevenueY3 = tempRevenuevalue;
							totalIncreamentalRevenueForNextYear = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1);
							//totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*annualRevenueEscalation_t/100 ;	
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year3"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
							totalDeltaIncreamentalRevenueYear1 = totalIncreamentalRevenueForNextYear*annualEscalationFloat/100 ;	
						}else{
							
							
							put(PricingDict,ItemDescription+"_Year3",(totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear3);
							totalContractRevenueY3 = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear3;
							totalIncreamentalRevenueForNextYear = totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1;
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year3"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
							totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;
						}
					}
					
					if(year4Flag){
						if(containskey(PricingDict,ItemDescription+"_Year4")){
							
							tempRevenuevalue = get(PricingDict,ItemDescription+"_Year4");
							//tempRevenuevalue = tempRevenuevalue + line.extNetPrice_l*termFactorYear4;
							tempRevenuevalue = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear4;
							put(PricingDict,itemDescription+"_Year4",tempRevenuevalue);
							totalContractRevenueY4 = tempRevenuevalue;
							totalIncreamentalRevenueForNextYear = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1);
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year4"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
							totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;	
						}else{
						 put(PricingDict,ItemDescription+"_Year4",(totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear4);
						 totalContractRevenueY4 = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear4;
						//put(PricingDict,ItemDescription+"_Year4",line.extNetPrice_l*termFactorYear2+totalDeltaIncreamentalRevenueYear1);
						totalIncreamentalRevenueForNextYear = totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1;
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year4"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
						totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;
						}
					}
					if(year5Flag){
						if(containskey(PricingDict,ItemDescription+"_Year5")){
							
							tempRevenuevalue = get(PricingDict,ItemDescription+"_Year5");
							//tempRevenuevalue = tempRevenuevalue + line.extNetPrice_l*termFactorYear5;
							tempRevenuevalue = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear5;
							put(PricingDict,itemDescription+"_Year5",tempRevenuevalue);
							totalContractRevenueY5 = tempRevenuevalue;
							totalIncreamentalRevenueForNextYear = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1);
							totalIncreamentalRevenueForNextYear = totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1;
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year5"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
							totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat /100 ;	
						}else{
						 put(PricingDict,ItemDescription+"_Year5",(totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear5);
							totalContractRevenueY5 = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear5;//put(PricingDict,ItemDescription+"_Year5",line.extNetPrice_l*termFactorYear2+totalDeltaIncreamentalRevenueYear1);
							totalIncreamentalRevenueForNextYear = totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1;
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year5"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
									annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
						totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;
						}
					}
					
					if(year6Flag){
						
						print "YEAR 6 Term---";
						print termFactorYear6;
						if(containskey(PricingDict,ItemDescription+"_Year6")){
							
							tempRevenuevalue = get(PricingDict,ItemDescription+"_Year6");
							//tempRevenuevalue = tempRevenuevalue + line.extNetPrice_l*termFactorYear5;
							tempRevenuevalue = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear6;
							put(PricingDict,itemDescription+"_Year6",tempRevenuevalue);
							totalContractRevenueY6 = tempRevenuevalue;
							totalIncreamentalRevenueForNextYear = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1);
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year6"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
							totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;	
							}else{
							
						 put(PricingDict,ItemDescription+"_Year6",(totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear6);
						totalContractRevenueY6 = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear6;//put(PricingDict,ItemDescription+"_Year5",line.extNetPrice_l*termFactorYear2+totalDeltaIncreamentalRevenueYear1);
						totalIncreamentalRevenueForNextYear = totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1;
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year6"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
						totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;
						}
					}
					
					if(year7Flag){
						
						print "YEAR 7 Term---";
						print termFactorYear7;
						if(containskey(PricingDict,ItemDescription+"_Year7")){
							
							tempRevenuevalue = get(PricingDict,ItemDescription+"_Year7");
							//tempRevenuevalue = tempRevenuevalue + line.extNetPrice_l*termFactorYear5;
							tempRevenuevalue = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear7;
							put(PricingDict,itemDescription+"_Year7",tempRevenuevalue);
							totalContractRevenueY7 = tempRevenuevalue;
							totalIncreamentalRevenueForNextYear = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1);
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year7"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
							totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;	
						}else{
						 put(PricingDict,ItemDescription+"_Year7",(totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear7);
						totalContractRevenueY7 = (totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1)*termFactorYear7;//put(PricingDict,ItemDescription+"_Year5",line.extNetPrice_l*termFactorYear2+totalDeltaIncreamentalRevenueYear1);
						totalIncreamentalRevenueForNextYear = totalIncreamentalRevenueForNextYear+totalDeltaIncreamentalRevenueYear1;
							if(variableAnnualRevenueEscalation_t == true){
								annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year7"));
								if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
								annualEscalationFloat = atof(annualEscalationVar );
								}
							}else{
								annualEscalationFloat = annualRevenueEscalation_t;
							}
						totalDeltaIncreamentalRevenueYear1 = (totalIncreamentalRevenueForNextYear)*annualEscalationFloat/100 ;
						}
					}
					totalContractRevenue = totalContractRevenueY1 +totalContractRevenueY2+totalContractRevenueY3+totalContractRevenueY4+totalContractRevenueY5+totalContractRevenueY6+totalContractRevenueY7;
					put(PricingDict,ItemDescription+"_Total Contract",totalContractRevenue);
					//End_HYPERCARE-CR_CHG#0082000_CR#41_Description_by Namrata
				}elif(find(itemDescription,"Recurring Sales Cost") <> -1 OR find(itemDescription,"Total Sales Cost") <> -1 OR find(itemDescription,"Total Standard Cost") <> -1 OR find(itemDescription,"Recurring Standard Cost") <> -1){
					IncreamentalCostTotal =0.0;
					//print "SC inside---";
					unitCostValue = 0.0;
					//Total Standard Cost
					if(find(itemDescription,"Standard Cost") <> -1){
					unitCostValue = line.unitCost_l;
					
					
					}else{
					unitCostValue = line.unitSalesCost_l;	
					
					}
					
				// condition to filter Cost Items of the each component from the data table.......
						//print "IncreamentalCostTotal-BEFORE--";print IncreamentalCostTotal;
					// if(find(itemDescription,"Total Sales Cost") <> -1 OR find(itemDescription,"Total Standard Cost") <> -1){
						
						// IncreamentalCostTotal = line._price_quantity*line.implementationCost_l;
					// }
					
					if(containskey(PricingDict,itemDescription+"_Year1")){
						
						tempCostvalue = get(PricingDict,itemDescription+"_Year1");
						tempCostvalueWithoutTerm = tempCostvalue/termFactorYear1;
						tempCostvalue = tempCostvalue + (line._price_quantity *unitCostValue*termFactorYear1)+IncreamentalCostTotal;
						tempCostvalueWithoutTerm = tempCostvalueWithoutTerm + line._price_quantity *unitCostValue;
						//print "tempCostvalue- if--";
						//print tempCostvalue;
						put(PricingDict,itemDescription+"_Year1",tempCostvalue);
						totalContractCostY1 =  tempCostvalue;
						totalDeltaIncreamentalCostYear1 = (tempCostvalueWithoutTerm*costEscalation_t/100) ;	
						totalIncreamentalCostForNextYear =  tempCostvalueWithoutTerm;
						
						
					}else{
							//print "itemDescription--y1-";
							//print itemDescription;
							// print unitCostValue;
							// print termFactorYear1;
						
							//print (line._price_quantity *unitCostValue*termFactorYear1);
							//print "---";
					
					put(PricingDict,itemDescription+"_Year1",(line._price_quantity *unitCostValue*termFactorYear1)+IncreamentalCostTotal);
					
					totalDeltaIncreamentalCostYear1 = ((line._price_quantity *unitCostValue)*costEscalation_t/100) ;
					totalIncreamentalCostForNextYear = (line._price_quantity *unitCostValue);
					totalContractCostY1 =  (line._price_quantity *unitCostValue*termFactorYear1)+IncreamentalCostTotal;
					}
					
					if(year2Flag){
						if(containskey(PricingDict,itemDescription+"_Year2")){
							
							tempCostvalue = get(PricingDict,ItemDescription+"_Year2");
						
							tempCostvalue = (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear2;
							
							put(PricingDict,itemDescription+"_Year2",tempCostvalue);
							totalContractCostY2 =  tempCostvalue;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
							totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}else{
							
							
							put(PricingDict,ItemDescription+"_Year2",(totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear2);
							totalContractCostY2 =  (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear2;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
							totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}
					}
					if(year3Flag){
						if(containskey(PricingDict,ItemDescription+"_Year3")){
							
							tempCostvalue = get(PricingDict,ItemDescription+"_Year3");
							
							tempCostvalue = (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear3;
							put(PricingDict,itemDescription+"_Year3",tempCostvalue);
							totalContractCostY3 =  tempCostvalue;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
							totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}else{
							put(PricingDict,ItemDescription+"_Year3",(totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear3);
							totalContractCostY3 =  (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear3;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
							totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}
						
					
					
					}
					
					if(year4Flag){
						if(containskey(PricingDict,ItemDescription+"_Year4")){
							
							tempCostvalue = get(PricingDict,ItemDescription+"_Year4");
							//tempCostvalue = tempCostvalue + line._price_quantity *unitCostValue*termFactorYear4;
							tempCostvalue = (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear4;
							put(PricingDict,itemDescription+"_Year4",tempCostvalue);
							totalContractCostY4 =  tempCostvalue;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}else{
						put(PricingDict,ItemDescription+"_Year4",(totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear4);
						totalContractCostY4 =  (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear4;
						totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}
					}
					if(year5Flag){
						if(containskey(PricingDict,ItemDescription+"_Year5")){
							
							tempCostvalue = get(PricingDict,ItemDescription+"_Year5");
							//tempCostvalue = tempCostvalue + line._price_quantity *unitCostValue*termFactorYear5;
							tempCostvalue = (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear5;
							put(PricingDict,itemDescription+"_Year5",tempCostvalue);
							totalContractCostY5 =  tempCostvalue;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}else{
						put(PricingDict,ItemDescription+"_Year5",(totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear3);
						totalContractCostY5 =  (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear5;
						totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}
					}
					
					if(year6Flag){
						if(containskey(PricingDict,ItemDescription+"_Year6")){
							
							tempCostvalue = get(PricingDict,ItemDescription+"_Year6");
							tempCostvalue = (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear6;
							put(PricingDict,itemDescription+"_Year6",tempCostvalue);
							totalContractCostY6 =  tempCostvalue;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}else{
						put(PricingDict,ItemDescription+"_Year6",(totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear6);
						totalContractCostY6 =  (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear6;
						totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}
					}
					
					if(year7Flag){
						if(containskey(PricingDict,ItemDescription+"_Year7")){
							
							tempCostvalue = get(PricingDict,ItemDescription+"_Year7");
							tempCostvalue = (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear7;
							put(PricingDict,itemDescription+"_Year7",tempCostvalue);
							totalContractCostY7 =  tempCostvalue;
							totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*costEscalation_t/100 ;
						}else{
						put(PricingDict,ItemDescription+"_Year7",(totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear7);
						totalContractCostY7 =  (totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1)*termFactorYear7;
						
						totalIncreamentalCostForNextYear = totalIncreamentalCostForNextYear+totalDeltaIncreamentalCostYear1;
						totalDeltaIncreamentalCostYear1 = (totalIncreamentalCostForNextYear)*costEscalation_t/100 ;
						}
					}
					totalContractCost = totalContractCostY1+totalContractCostY2+totalContractCostY3+totalContractCostY4+totalContractCostY5+totalContractCostY6+totalContractCostY7;
					put(PricingDict,ItemDescription+"_Total Contract",totalContractCost);
				}elif(find(itemDescription,"Sales Cost GM") <> -1 OR find(itemDescription,"Standard Cost GM") <> -1){
						// print " GM--- isndie---";
						// print "itemDescription--";
						// print itemDescription;
					  if(find(itemDescription,"Sales Cost GM") <> -1){
						 tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
						 tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
					  }elif(find(itemDescription,"Standard Cost GM") <> -1){
						  tempDescriptionRev = replace(itemDescription,"Standard Cost GM","Revenue");
						  tempDescriptionCost = replace(itemDescription,"Standard Cost GM","Total Standard Cost");
					  }
					
					  // print tempDescriptionRev;
					  // print tempDescriptionCost;
					  if(not(isnull(get(PricingDict,tempDescriptionRev+"_Year1")))){
						totalREV_Y1= get(PricingDict,tempDescriptionRev+"_Year1");
					  }
					 
					  if(not(isnull(get(PricingDict,tempDescriptionCost+"_Year1")))){
						totalCOST_Y1= get(PricingDict,tempDescriptionCost+"_Year1");
					  }
						
					totalMarginValue = totalREV_Y1 - totalCOST_Y1;
						// print totalMarginValue;
						// print "----";
					totalContractGrossMargin = totalContractGrossMargin + totalMarginValue;
					put(PricingDict,itemDescription+"_Year1",totalMarginValue);
					
					
					if(totalREV_Y1 <> 0.0){
					year1MarginPercent = (totalMarginValue/totalREV_Y1)*100;
					}
				
					if(year2Flag){
						
						//tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
						  if(find(itemDescription,"Sales Cost GM") <> -1){
						 tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
						 tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
						  }elif(find(itemDescription,"Standard Cost GM") <> -1){
							  tempDescriptionRev = replace(itemDescription,"Standard Cost GM","Revenue");
							  tempDescriptionCost = replace(itemDescription,"Standard Cost GM","Total Standard Cost");
						  }
					  
					  
						 if(not(isnull(get(PricingDict,tempDescriptionRev+"_Year2")))){
						totalREV_Y1= get(PricingDict,tempDescriptionRev+"_Year2");
						 }
						// tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
						  if(not(isnull(get(PricingDict,tempDescriptionCost+"_Year2")))){
						totalCOST_Y1= get(PricingDict,tempDescriptionCost+"_Year2");
						  }
					
						totalMarginValue = totalREV_Y1 - totalCOST_Y1;
						totalContractGrossMargin = totalContractGrossMargin + totalMarginValue;
						put(PricingDict,itemDescription+"_Year2",totalMarginValue);
						if(totalREV_Y1 <> 0.0){
						year2MarginPercent = (totalMarginValue/totalREV_Y1)*100;
						}
					}
					if(year3Flag){
						// if(containskey(PricingDict,ItemDescription+"_Year3")){
							
							// tempCostvalue = get(PricingDict,ItemDescription+"_Year3");
							// totalMarginValue = (line.extNetPrice_l - line._price_quantity *line.unitSalesCost_l)*termFactorYear3;
							// tempCostvalue = tempCostvalue + totalMarginValue;
							// put(PricingDict,ItemDescription+"_Year3",tempCostvalue);
						// }else{
							// totalMarginValue = (line.extNetPrice_l - line._price_quantity *line.unitSalesCost_l)*termFactorYear3;
						// put(PricingDict,ItemDescription+"_Year3",totalMarginValue);
						// }
						
						//tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
						
						 if(find(itemDescription,"Sales Cost GM") <> -1){
						 tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
						 tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
						  }elif(find(itemDescription,"Standard Cost GM") <> -1){
							  tempDescriptionRev = replace(itemDescription,"Standard Cost GM","Revenue");
							  tempDescriptionCost = replace(itemDescription,"Standard Cost GM","Total Standard Cost");
						  }
					  
					  
					  
						if(not(isnull(get(PricingDict,tempDescriptionRev+"_Year3")))){
						totalREV_Y1= get(PricingDict,tempDescriptionRev+"_Year3");
						}
						// tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
						 if(not(isnull(get(PricingDict,tempDescriptionCost+"_Year3")))){
						totalCOST_Y1= get(PricingDict,tempDescriptionCost+"_Year3");
						 }
					
					totalMarginValue = totalREV_Y1 - totalCOST_Y1;
					totalContractGrossMargin = totalContractGrossMargin + totalMarginValue;
					put(PricingDict,itemDescription+"_Year3",totalMarginValue);
					if(totalREV_Y1 <> 0.0){
					year3MarginPercent = (totalMarginValue/totalREV_Y1)*100;
					}
					
					}
					
					if(year4Flag){
						
						 if(find(itemDescription,"Sales Cost GM") <> -1){
							 tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
							 tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
						  }elif(find(itemDescription,"Standard Cost GM") <> -1){
							  tempDescriptionRev = replace(itemDescription,"Standard Cost GM","Revenue");
							  tempDescriptionCost = replace(itemDescription,"Standard Cost GM","Total Standard Cost");
						  }
					  
						
						//tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
						if(not(isnull(get(PricingDict,tempDescriptionRev+"_Year4")))){
						totalREV_Y1= get(PricingDict,tempDescriptionRev+"_Year4");
						}
						// tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
						 if(not(isnull(get(PricingDict,tempDescriptionCost+"_Year4")))){
						totalCOST_Y1= get(PricingDict,tempDescriptionCost+"_Year4");
						 }
						
					
					totalMarginValue = totalREV_Y1 - totalCOST_Y1;
					totalContractGrossMargin = totalContractGrossMargin + totalMarginValue;
					put(PricingDict,itemDescription+"_Year4",totalMarginValue);
						if(totalREV_Y1 <> 0.0){
						year4MarginPercent = (totalMarginValue/totalREV_Y1)*100;
						}
					}
					if(year5Flag){
						
							 if(find(itemDescription,"Sales Cost GM") <> -1){
								 tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
								 tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
							  }elif(find(itemDescription,"Standard Cost GM") <> -1){
								  tempDescriptionRev = replace(itemDescription,"Standard Cost GM","Revenue");
								  tempDescriptionCost = replace(itemDescription,"Standard Cost GM","Total Standard Cost");
							  }
							//tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
							if(not(isnull(get(PricingDict,tempDescriptionRev+"_Year5")))){
							totalREV_Y1= get(PricingDict,tempDescriptionRev+"_Year5");
							}
							 //tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
							 if(not(isnull(get(PricingDict,tempDescriptionCost+"_Year5")))){
							totalCOST_Y1= get(PricingDict,tempDescriptionCost+"_Year5");
							 }
					
						totalMarginValue = totalREV_Y1 - totalCOST_Y1;
						totalContractGrossMargin = totalContractGrossMargin + totalMarginValue;
						put(PricingDict,itemDescription+"_Year5",totalMarginValue);
						if(totalREV_Y1 <> 0.0){
						year5MarginPercent = (totalMarginValue/totalREV_Y1)*100;
						}
					}
					
					if(year6Flag){
						
							 if(find(itemDescription,"Sales Cost GM") <> -1){
								 tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
								 tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
							  }elif(find(itemDescription,"Standard Cost GM") <> -1){
								  tempDescriptionRev = replace(itemDescription,"Standard Cost GM","Revenue");
								  tempDescriptionCost = replace(itemDescription,"Standard Cost GM","Total Standard Cost");
							  }
							//tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
							if(not(isnull(get(PricingDict,tempDescriptionRev+"_Year6")))){
							totalREV_Y1= get(PricingDict,tempDescriptionRev+"_Year6");
							}
							 //tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
							 if(not(isnull(get(PricingDict,tempDescriptionCost+"_Year6")))){
							totalCOST_Y1= get(PricingDict,tempDescriptionCost+"_Year6");
							 }
					
						totalMarginValue = totalREV_Y1 - totalCOST_Y1;
						totalContractGrossMargin = totalContractGrossMargin + totalMarginValue;
						put(PricingDict,itemDescription+"_Year6",totalMarginValue);
						if(totalREV_Y1 <> 0.0){
							
						year6MarginPercent = (totalMarginValue/totalREV_Y1)*100;
						}
						
					}
					
					if(year7Flag){
						
							 if(find(itemDescription,"Sales Cost GM") <> -1){
								 tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
								 tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
							  }elif(find(itemDescription,"Standard Cost GM") <> -1){
								  tempDescriptionRev = replace(itemDescription,"Standard Cost GM","Revenue");
								  tempDescriptionCost = replace(itemDescription,"Standard Cost GM","Total Standard Cost");
							  }
							//tempDescriptionRev = replace(itemDescription,"Sales Cost GM","Revenue");
							if(not(isnull(get(PricingDict,tempDescriptionRev+"_Year7")))){
							totalREV_Y1= get(PricingDict,tempDescriptionRev+"_Year7");
							}
							// tempDescriptionCost = replace(itemDescription,"Sales Cost GM","Total Sales Cost");
							 if(not(isnull(get(PricingDict,tempDescriptionCost+"_Year7")))){
							totalCOST_Y1= get(PricingDict,tempDescriptionCost+"_Year7");
							 }
					
						totalMarginValue = totalREV_Y1 - totalCOST_Y1;
						totalContractGrossMargin = totalContractGrossMargin + totalMarginValue;
						put(PricingDict,itemDescription+"_Year7",totalMarginValue);
						if(totalREV_Y1 <> 0.0){
						year7MarginPercent = (totalMarginValue/totalREV_Y1)*100;
						}
					}
						put(PricingDict,ItemDescription+"_Total Contract",totalContractGrossMargin);
				}elif(find(itemDescription,"Sales Cost Margin%") <> -1 OR find(itemDescription,"Standard Cost Margin%") <> -1){
					
						put(PricingDict,itemDescription+"_Year1",round(year1MarginPercent,2));
						
					
					if(year2Flag){
					
						put(PricingDict,itemDescription+"_Year2",round(year2MarginPercent,2));
					}
					if(year3Flag){
							
							
						put(PricingDict,itemDescription+"_Year3",round(year3MarginPercent,2));
						
					}
					
					if(year4Flag){
							
							put(PricingDict,itemDescription+"_Year4",round(year4MarginPercent,2));
					}
					if(year5Flag){
						
						put(PricingDict,itemDescription+"_Year5",round(year5MarginPercent,2));
					}
					
					if(year6Flag){
							
							put(PricingDict,itemDescription+"_Year6",round(year6MarginPercent,2));
					}
					if(year7Flag){
						
						put(PricingDict,itemDescription+"_Year7",round(year7MarginPercent,2));
					}
					
					
					
					if(find(itemDescription,"Sales Cost Margin%") <> -1){
					ItemDescriptionTempGM = replace(ItemDescription,"Sales Cost Margin%","Sales Cost GM");
					ItemDescriptionTempRev = replace(ItemDescription,"Sales Cost Margin%","Revenue");
					}else{
					ItemDescriptionTempGM = replace(ItemDescription,"Standard Cost Margin%","Standard Cost GM");	
					ItemDescriptionTempRev = replace(ItemDescription,"Standard Cost Margin%","Revenue");
					}
					//print ItemDescriptionTempRev;
					if(not(isnull(get(PricingDict,ItemDescriptionTempRev+"_Total Contract")))){
					totalContractRevenue = get(PricingDict,ItemDescriptionTempRev+"_Total Contract");
					}
					if(not(isnull(get(PricingDict,ItemDescriptionTempGM+"_Total Contract")))){
					totalContractGrossMargin = get(PricingDict,ItemDescriptionTempGM+"_Total Contract");
					}
					//print "------------1243000";
					
					//print totalContractGrossMargin;
					//print totalContractRevenue;
					if(totalContractRevenue <> 0.0){
					totalContractGrossMarginPercent = (totalContractGrossMargin/totalContractRevenue)*100;
					}
					//print "totalContractGrossMarginPercent--";
					//print totalContractGrossMarginPercent;
					put(PricingDict,ItemDescription+"_Total Contract",totalContractGrossMarginPercent);

				}
			}
		}
	}	
			// code to populate first month billing Array ---------
			
			if((get(eachData,"SectionName") =="First Month Billing")){
				tempCostvalueFMB = 0.0;
				tempRevenuevalueFMB = 0.0;
				
				if(itemtype == "Ancillary Cost"){
					itemtype = "Area Costs (Phone,PC)";
				}
				if(itemtype<>"" AND NOT ISNULL(itemtype)){
				//print processGroup;
					// the below condition require to split Other service line item in 3rd party and non third party category
					//added MPS Condition by Namrata to exclude MPS lines Defect ID : 20835

					if((find(itemtype,"3rd Party") <> -1 AND get(eachData,"Item")== "Other Services-"+itemtype AND processGroup == "MS") OR (find(itemtype,"3rd Party") == -1 AND find(get(eachData,"Item"),itemtype) <> -1) AND processGroup <> "MPS"){
						firstMonthItemDesc =get(eachData,"Item");
						
						// total first Month Revenue per component------------
						
						if(containskey(PricingDict,firstMonthItemDesc+"_Month1_REV")){
							
							tempRevenuevalueFMB = get(PricingDict,firstMonthItemDesc+"_Month1_REV");
							tempRevenuevalueFMB = tempRevenuevalueFMB + line.extNetPrice_l;
							put(PricingDict,firstMonthItemDesc+"_Month1_REV",tempRevenuevalueFMB);
						}else{
							
						put(PricingDict,firstMonthItemDesc+"_Month1_REV",line.extNetPrice_l);
						}
						
						// total first Month cost per component------
						if(containskey(PricingDict,firstMonthItemDesc+"_Month1_COST")){
							
							tempCostvalueFMB = get(PricingDict,firstMonthItemDesc+"_Month1_COST");
							tempCostvalueFMB = tempCostvalueFMB + line._price_quantity *line.unitSalesCost_l;
								put(PricingDict,firstMonthItemDesc+"_Month1_COST",tempCostvalueFMB);
						}else{
							
							
						put(PricingDict,firstMonthItemDesc+"_Month1_COST",line._price_quantity *line.unitSalesCost_l);
						}
						
					}
				}
				
			
			}
		}
	
	}
	
}



// use single Query for pricing approval
// Move the query line here to use to populate Total deal Margin Threshold in deal Margin table.

approverTable = BMQL("SELECT * FROM MS_ApprovalMrg");	

termFactor =1;


// the below Lines include Calculation for revenue escalation in MS deal section against each year. The reference is taken from total revenue calculated by looping over transaction Line.
			
//START_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata.

if(contractTerm <=12){
	termFactor = contractTerm;
    	totalMonthlyRevenueYear1 = totalMonthlyRevenue * contractTerm;
	totalMonthlyCostYear1 = totalMonthlyCost * contractTerm;
	totalMonthlyStandardCostYear1  =totalMonthlyStandardCost * contractTerm;
	totalImplementationCostYear1 = totalImplementationCostValue ; 
}else{
   totalMonthlyRevenueYear1 = totalMonthlyRevenue * 12;	
   totalMonthlyCostYear1 = totalMonthlyCost * 12;
   totalMonthlyStandardCostYear1  = totalMonthlyStandardCost * 12;
   totalImplementationCostYear1 = round(totalImplementationCostValue,2);
   totalImplementationCostVar = totalImplementationCostValue/12;
  print "totalMonthlyRevenue "; print totalMonthlyCostYear1 ;
   
}

if(contractTerm > 12 AND contractTerm <= 24){
	termFactor = fmod(contractTerm, 12);

	if(termFactor == 0.0){
		termFactor =12;
	}
}elif(contractTerm > 24){
	termFactor =12;
}	
if(contractTerm > 12){
//Start_HYPERCARE-CR_CHG#0082000_CR#41_Description_by Namrata
//changes done to apply annaul escalation % on the basis of each year
//START_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata. Changes done for implementation cost in each year
if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year1"));
	if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
	}
}else{
	annualEscalationFloat = annualRevenueEscalation_t;
}
totalMonthlyRevenueYear2 = (totalMonthlyRevenue *termFactor)+((totalMonthlyRevenue*termFactor) * annualEscalationFloat/100);
totalMonthlyCostYear2 = (totalMonthlyCost * termFactor)+((totalMonthlyCost*termFactor) * costEscalation_t/100);
totalMonthlyStandardCostYear2  = (totalMonthlyStandardCost * termFactor)+((totalMonthlyStandardCost*termFactor) * costEscalation_t/100);
totalMonthlyRevenue = totalMonthlyRevenue +(totalMonthlyRevenue*annualEscalationFloat/100) ;
totalMonthlyCost = totalMonthlyCost +(totalMonthlyCost*costEscalation_t/100) ;
totalMonthlyStandardCost = totalMonthlyStandardCost +(totalMonthlyStandardCost*costEscalation_t/100) ;
totalImplementationCostYear2 = round((totalImplementationCostVar*termFactor) + ((totalImplementationCostVar *termFactor) * costEscalation_t/100),2);
totalImplementationCostVar = totalImplementationCostVar +(totalImplementationCostVar*costEscalation_t/100) ;

}
if(contractTerm > 24 AND contractTerm <= 36){
	termFactor = fmod(contractTerm, 12);
	if(termFactor == 0.0){
		termFactor =12;
	}
}elif(contractTerm > 36){
	termFactor =12;
}
if(contractTerm > 24){

	if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year2"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}
totalMonthlyRevenueYear3 = (totalMonthlyRevenue*termFactor)+((totalMonthlyRevenue*termFactor) * annualEscalationFloat /100);
totalMonthlyCostYear3 = (totalMonthlyCost * termFactor)+((totalMonthlyCost*termFactor) * costEscalation_t/100);
totalMonthlyStandardCostYear3 = (totalMonthlyStandardCost * termFactor)+((totalMonthlyStandardCost*termFactor) * costEscalation_t/100);

totalMonthlyRevenue = totalMonthlyRevenue +(totalMonthlyRevenue*annualEscalationFloat /100) ;
totalMonthlyCost = totalMonthlyCost +(totalMonthlyCost*costEscalation_t/100) ;
totalMonthlyStandardCost = totalMonthlyStandardCost +(totalMonthlyStandardCost*costEscalation_t/100) ;
//print totalImplementationCostVar ;
totalImplementationCostYear3 = round((totalImplementationCostVar *termFactor) + ((totalImplementationCostVar *termFactor) * costEscalation_t/100),2);
//print ((totalImplementationCostVar *termFactor) * costEscalation_t/100);
totalImplementationCostVar = totalImplementationCostVar +(totalImplementationCostVar*costEscalation_t/100) ;

}
if(contractTerm > 36 AND contractTerm <=48){
//commenting the below code for CHG0086386
/*
	if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year3"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}
	*/
	termFactor = fmod(contractTerm, 12);
	if(termFactor == 0.0){
		termFactor =12;
	}
}elif(contractTerm > 48){
	termFactor =12;
}
if(contractTerm > 36){
//code added by Rohit for  CHG0086386 to calculate aanuslaEscationFloat value

if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year3"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}

totalMonthlyCostYear4 = (totalMonthlyCost * termFactor)+((totalMonthlyCost*termFactor) * costEscalation_t/100);
totalMonthlyStandardCostYear4 = (totalMonthlyStandardCost * termFactor)+((totalMonthlyStandardCost*termFactor) * costEscalation_t/100);
totalMonthlyRevenueYear4 = (totalMonthlyRevenue*termFactor)+((totalMonthlyRevenue*termFactor) * annualEscalationFloat/100);
 totalMonthlyRevenue = totalMonthlyRevenue +(totalMonthlyRevenue*annualEscalationFloat/100) ;
 totalMonthlyCost = totalMonthlyCost +(totalMonthlyCost*costEscalation_t/100) ;
 totalMonthlyStandardCost = totalMonthlyStandardCost +(totalMonthlyStandardCost*costEscalation_t/100) ;
 totalImplementationCostYear4 = round((totalImplementationCostVar *termFactor) + ((totalImplementationCostVar *termFactor) * costEscalation_t/100),2);
totalImplementationCostVar = totalImplementationCostVar +(totalImplementationCostVar*costEscalation_t/100) ;

}
if(contractTerm > 48 AND contractTerm <=60){
//commenting the below code for CHG0086386
/*
	if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year4"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}
	*/
	termFactor = fmod(contractTerm, 12);
	if(termFactor == 0.0){
		termFactor =12;
	}
}elif(contractTerm > 60){
	termFactor =12;
}
if(contractTerm > 48){
//code added by Rohit for  CHG0086386 to calculate aanuslaEscationFloat value

if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year4"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}

totalMonthlyRevenueYear5 = (totalMonthlyRevenue*termFactor)+((totalMonthlyRevenue*termFactor) * annualEscalationFloat/100);
totalMonthlyCostYear5 = (totalMonthlyCost * termFactor)+((totalMonthlyCost*termFactor) * costEscalation_t/100);
totalMonthlyStandardCostYear5 = (totalMonthlyStandardCost * termFactor)+((totalMonthlyStandardCost*termFactor) * costEscalation_t/100);
totalMonthlyRevenue = totalMonthlyRevenue +(totalMonthlyRevenue*annualEscalationFloat/100) ;
totalMonthlyCost = totalMonthlyCost +(totalMonthlyCost*costEscalation_t/100) ;
 totalMonthlyStandardCost = totalMonthlyStandardCost +(totalMonthlyStandardCost*costEscalation_t/100) ;
totalImplementationCostYear5 = round((totalImplementationCostVar *termFactor) + ((totalImplementationCostVar *termFactor) * costEscalation_t/100),2);
totalImplementationCostVar = totalImplementationCostVar +(totalImplementationCostVar*costEscalation_t/100) ;

}
if(contractTerm > 60 AND contractTerm <=72){
//commenting the below code for CHG0086386
/*
	if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year5"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}
	*/
	termFactor = fmod(contractTerm, 12);
	if(termFactor == 0.0){
		termFactor =12;
	}
}elif(contractTerm > 72){
	termFactor =12;
}
if(contractTerm > 60){
	//code added by Rohit for  CHG0086386 to calculate aanuslaEscationFloat value
	
if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year5"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}
	
totalMonthlyRevenueYear6 = (totalMonthlyRevenue*termFactor)+((totalMonthlyRevenue*termFactor) * annualEscalationFloat/100);
totalMonthlyCostYear6 = (totalMonthlyCost * termFactor)+((totalMonthlyCost*termFactor) * costEscalation_t/100);
totalMonthlyStandardCostYear6 = (totalMonthlyStandardCost * termFactor)+((totalMonthlyStandardCost*termFactor) * costEscalation_t/100);
totalMonthlyRevenue = totalMonthlyRevenue +(totalMonthlyRevenue*annualEscalationFloat/100) ;
totalMonthlyCost = totalMonthlyCost +(totalMonthlyCost*costEscalation_t/100) ;
 totalMonthlyStandardCost = totalMonthlyStandardCost +(totalMonthlyStandardCost*costEscalation_t/100) ;
totalImplementationCostYear6 = round((totalImplementationCostVar *termFactor) + ((totalImplementationCostVar *termFactor) * costEscalation_t/100),2);
totalImplementationCostVar = totalImplementationCostVar +(totalImplementationCostVar*costEscalation_t/100) ;
}

if(contractTerm > 72 AND contractTerm <=84){
	if(variableAnnualRevenueEscalation_t == true){
	annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year6"));
		if(annualEscalationVar <> "" AND not(isnull(annualEscalationVar))){
		annualEscalationFloat = atof(annualEscalationVar );
		}
	}else{
	annualEscalationFloat = annualRevenueEscalation_t;
	}
	termFactor = fmod(contractTerm, 12);
	if(termFactor == 0.0){
		termFactor =12;
	}
	
totalMonthlyRevenueYear7 = (totalMonthlyRevenue*termFactor)+((totalMonthlyRevenue*termFactor) * annualEscalationFloat/100);
totalMonthlyCostYear7 = (totalMonthlyCost * termFactor)+((totalMonthlyCost*termFactor) * costEscalation_t/100);
totalMonthlyStandardCostYear7 = (totalMonthlyStandardCost * termFactor)+((totalMonthlyStandardCost*termFactor) * costEscalation_t/100);
totalImplementationCostYear7 = round((totalImplementationCostVar *termFactor) + ((totalImplementationCostVar *termFactor) * costEscalation_t/100),2);

//End_POST MVP-CR_CHG#0082000_CR#64_Description_by Namrata
//End_HYPERCARE-CR_CHG#0082000_CR#41_Description_by Namrata
}

// rebate calculation in Total deal Margin table----
if(rebateValueOption_t == "rebateValue"){
	
	if(rebateApplied_t == "oneTime"){
	totalRebateCostYear1 = rebateDollarMonthly;
	}else{
	totalRebateCostYear1 = rebateDollarMonthly*termFactorYear1;	
	}
	if(year2Flag AND rebateApplied_t <> "oneTime"){
	totalRebateCostYear2 = rebateDollarMonthly*termFactorYear2;
	}
	if(year3Flag AND rebateApplied_t <> "oneTime"){
	totalRebateCostYear3 = rebateDollarMonthly*termFactorYear3;
	}
	if(year4Flag AND rebateApplied_t <> "oneTime"){
	totalRebateCostYear4 = rebateDollarMonthly*termFactorYear4;
	}
	if(year5Flag AND rebateApplied_t <> "oneTime"){
	totalRebateCostYear5 = rebateDollarMonthly*termFactorYear5;
	}
	if(year6Flag AND rebateApplied_t <> "oneTime"){
	totalRebateCostYear6 = rebateDollarMonthly*termFactorYear6;
	}
	if(year7Flag AND rebateApplied_t <> "oneTime"){
	totalRebateCostYear7 = rebateDollarMonthly*termFactorYear7;
	}
	
	
}else{
	totalRebateCostYear1 = (totalMonthlyRevenueYear1*rebatePrecentage/100);
	totalRebateCostYear2 = (totalMonthlyRevenueYear2*rebatePrecentage/100);
	totalRebateCostYear3 = (totalMonthlyRevenueYear3*rebatePrecentage/100);
	totalRebateCostYear4 = (totalMonthlyRevenueYear4*rebatePrecentage/100);
	totalRebateCostYear5 = (totalMonthlyRevenueYear5*rebatePrecentage/100);
	totalRebateCostYear6 = (totalMonthlyRevenueYear6*rebatePrecentage/100);
	totalRebateCostYear7 = (totalMonthlyRevenueYear7*rebatePrecentage/100);
}
		
RebateCostTotalContract = totalRebateCostYear1+totalRebateCostYear2+totalRebateCostYear3+totalRebateCostYear4+totalRebateCostYear5+totalRebateCostYear6+totalRebateCostYear7;

//total cost calculations for all the years.........
totalDealcost1 =  totalDealUpfrontCost1 +totalImplementationCostYear1+ totalMonthlyCostYear1 +totalRebateCostYear1;

//START_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata.

totalDealcost2 =   totalMonthlyCostYear2+totalRebateCostYear2 + totalImplementationCostYear2;
totalDealcost3 =   totalMonthlyCostYear3+totalRebateCostYear3 + totalImplementationCostYear3;
totalDealcost4 =   totalMonthlyCostYear4+totalRebateCostYear4 + totalImplementationCostYear4;
totalDealcost5 =   totalMonthlyCostYear5+totalRebateCostYear5 + totalImplementationCostYear5;
totalDealcost6 =   totalMonthlyCostYear6+totalRebateCostYear6 + totalImplementationCostYear6;
totalDealcost7 =   totalMonthlyCostYear7+totalRebateCostYear7 + totalImplementationCostYear7;


// total standard deal cost part of CR086--
totalDealStandardcost1 =  totalDealUpfrontCost1 +totalImplementationCostYear1+ totalMonthlyStandardCostYear1 +totalRebateCostYear1;

totalDealStandardcost2 =   totalMonthlyStandardCostYear2+totalRebateCostYear2 + totalImplementationCostYear2;
totalDealStandardcost3 =   totalMonthlyStandardCostYear3+totalRebateCostYear3 + totalImplementationCostYear3;
totalDealStandardcost4 =   totalMonthlyStandardCostYear4+totalRebateCostYear4 + totalImplementationCostYear4;
totalDealStandardcost5 =   totalMonthlyStandardCostYear5+totalRebateCostYear5 + totalImplementationCostYear5;
totalDealStandardcost6 =   totalMonthlyStandardCostYear6+totalRebateCostYear6 + totalImplementationCostYear6;
totalDealStandardcost7 =   totalMonthlyStandardCostYear7+totalRebateCostYear7 + totalImplementationCostYear7;

// Gross Margin calculations for all years.
totalGM1 = totalMonthlyRevenueYear1-totalDealcost1;
totalGM2 = totalMonthlyRevenueYear2-totalDealcost2;
totalGM3 = totalMonthlyRevenueYear3-totalDealcost3;
totalGM4 = totalMonthlyRevenueYear4-totalDealcost4;
totalGM5 = totalMonthlyRevenueYear5-totalDealcost5;
totalGM6 = totalMonthlyRevenueYear6-totalDealcost6;
totalGM7 = totalMonthlyRevenueYear7-totalDealcost7;

// Gross Margin calculations for all years.
totalStandardCostGMYear1 = totalMonthlyRevenueYear1-totalDealStandardcost1;
totalStandardCostGMYear2 = totalMonthlyRevenueYear2-totalDealStandardcost2;
totalStandardCostGMYear3 = totalMonthlyRevenueYear3-totalDealStandardcost3;
totalStandardCostGMYear4 = totalMonthlyRevenueYear4-totalDealStandardcost4;
totalStandardCostGMYear5 = totalMonthlyRevenueYear5-totalDealStandardcost5;
totalStandardCostGMYear6 = totalMonthlyRevenueYear6-totalDealStandardcost6;
totalStandardCostGMYear7 = totalMonthlyRevenueYear7-totalDealStandardcost7;

if(totalMonthlyRevenueYear1 <> 0.0){
totalMarginPercent1 = (totalGM1/totalMonthlyRevenueYear1)*100;
totalStandardCostMerginPerYear1 = (totalStandardCostGMYear1/totalMonthlyRevenueYear1)*100;
}

if(totalMonthlyRevenueYear2 <> 0.0){
totalMarginPercent2 = (totalGM2/totalMonthlyRevenueYear2)*100;
totalStandardCostMerginPerYear2 = (totalStandardCostGMYear2/totalMonthlyRevenueYear2)*100;
}

if(totalMonthlyRevenueYear3 <> 0.0){
totalMarginPercent3 = (totalGM3/totalMonthlyRevenueYear3)*100;
totalStandardCostMerginPerYear3 = (totalStandardCostGMYear3/totalMonthlyRevenueYear3)*100;
}
if(totalMonthlyRevenueYear4 <> 0.0){
totalMarginPercent4 = (totalGM4/totalMonthlyRevenueYear4)*100;
totalStandardCostMerginPerYear4 = (totalStandardCostGMYear4/totalMonthlyRevenueYear4)*100;
}if(totalMonthlyRevenueYear5 <> 0.0){
totalMarginPercent5 = (totalGM5/totalMonthlyRevenueYear5)*100;
totalStandardCostMerginPerYear5 = (totalStandardCostGMYear5/totalMonthlyRevenueYear5)*100;
}
if(totalMonthlyRevenueYear6 <> 0.0){
totalMarginPercent6 = (totalGM6/totalMonthlyRevenueYear6)*100;
totalStandardCostMerginPerYear6 = (totalStandardCostGMYear6/totalMonthlyRevenueYear6)*100;
}if(totalMonthlyRevenueYear7 <> 0.0){
totalMarginPercent7 = (totalGM7/totalMonthlyRevenueYear7)*100;
totalStandardCostMerginPerYear7 = (totalStandardCostGMYear7/totalMonthlyRevenueYear7)*100;
}

//All total Contract Calculations-----------------
totaldealRevenueTotalContract = totalMonthlyRevenueYear1+totalMonthlyRevenueYear2+totalMonthlyRevenueYear3+totalMonthlyRevenueYear4+totalMonthlyRevenueYear5+totalMonthlyRevenueYear6+totalMonthlyRevenueYear7;


totaldealRecCostTotalContract = totalMonthlyCostYear1+totalMonthlyCostYear2+totalMonthlyCostYear3+totalMonthlyCostYear4+totalMonthlyCostYear5+totalMonthlyCostYear6+totalMonthlyCostYear7;

totalDealRecurringSTandardCostTotalContract = totalMonthlyStandardCostYear1+totalMonthlyStandardCostYear2+totalMonthlyStandardCostYear3+totalMonthlyStandardCostYear4+totalMonthlyStandardCostYear5+totalMonthlyStandardCostYear6+totalMonthlyStandardCostYear7;
//_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata.

totaldealImplementationCostTotalContract = totalImplementationCostYear1+totalImplementationCostYear2+totalImplementationCostYear3+totalImplementationCostYear4+totalImplementationCostYear5+totalImplementationCostYear6+totalImplementationCostYear7;

totaldealCostTotalContract=totalDealcost1+totalDealcost2+totalDealcost3+totalDealcost4+totalDealcost5+totalDealcost6+totalDealcost7;

totalDealSTandardCostTotalContract = totalDealStandardcost1 + totalDealStandardcost2 +totalDealStandardcost3+totalDealStandardcost4+totalDealStandardcost5+totalDealStandardcost6+totalDealStandardcost7;

totalGMTotalContract=totalGM1+totalGM2+totalGM3+totalGM4+totalGM5+totalGM6+totalGM7;

totalStandardGMTotalContract = totalStandardCostGMYear1+totalStandardCostGMYear2+totalStandardCostGMYear3+totalStandardCostGMYear4+totalStandardCostGMYear5+totalStandardCostGMYear6+totalStandardCostGMYear7;

if(totaldealRevenueTotalContract <> 0.0){
totalMarginTotalContract= (totalGMTotalContract/totaldealRevenueTotalContract)*100;
StandardCostMarginPerTotalContract = (totalStandardGMTotalContract/totaldealRevenueTotalContract)*100;
}

// below dictionary is to store all the different Parameters captured in  MS Total Deal Margin table
put(MSTotalDealDict,"Total Deal Revenue"+"_Year1",string(totalMonthlyRevenueYear1));
put(MSTotalDealDict,"Total Deal Revenue"+"_Year2",string(totalMonthlyRevenueYear2));
put(MSTotalDealDict,"Total Deal Revenue"+"_Year3",string(totalMonthlyRevenueYear3));
put(MSTotalDealDict,"Total Deal Revenue"+"_Year4",string(totalMonthlyRevenueYear4));
put(MSTotalDealDict,"Total Deal Revenue"+"_Year5",string(totalMonthlyRevenueYear5));
put(MSTotalDealDict,"Total Deal Revenue"+"_Year6",string(totalMonthlyRevenueYear6));
put(MSTotalDealDict,"Total Deal Revenue"+"_Year7",string(totalMonthlyRevenueYear7));
put(MSTotalDealDict,"Total Deal Revenue"+"_Total Contract",string(round(totaldealRevenueTotalContract,2)));

put(MSTotalDealDict,"Rebate Cost"+"_Year1",string(totalRebateCostYear1));
put(MSTotalDealDict,"Rebate Cost"+"_Year2",string(totalRebateCostYear2));
put(MSTotalDealDict,"Rebate Cost"+"_Year3",string(totalRebateCostYear3));
put(MSTotalDealDict,"Rebate Cost"+"_Year4",string(totalRebateCostYear4));
put(MSTotalDealDict,"Rebate Cost"+"_Year5",string(totalRebateCostYear5));
put(MSTotalDealDict,"Rebate Cost"+"_Year6",string(totalRebateCostYear6));
put(MSTotalDealDict,"Rebate Cost"+"_Year7",string(totalRebateCostYear7));
put(MSTotalDealDict,"Rebate Cost"+"_Total Contract",string(round(RebateCostTotalContract,2)));

put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Year1",string(totalMonthlyCostYear1));
put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Year2",string(totalMonthlyCostYear2));
put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Year3",string(totalMonthlyCostYear3));
put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Year4",string(totalMonthlyCostYear4));
put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Year5",string(totalMonthlyCostYear5));
put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Year6",string(totalMonthlyCostYear6));
put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Year7",string(totalMonthlyCostYear7));
put(MSTotalDealDict,"Total Deal Recurring Sales Cost"+"_Total Contract",string(round(totaldealRecCostTotalContract,2)));
//START_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata.
//print totalImplementationCostYear1 ;
put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Year1",string(totalImplementationCostYear1));
put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Year2",string(totalImplementationCostYear2));
put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Year3",string(totalImplementationCostYear3));
put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Year4",string(totalImplementationCostYear4));
put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Year5",string(totalImplementationCostYear5));
put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Year6",string(totalImplementationCostYear6));
put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Year7",string(totalImplementationCostYear7));
//END_Post MVP-CR_CHG#0082000_CR#64_Description_by Namrata.

put(MSTotalDealDict,"Cost Only - Implementation Cost"+"_Total Contract",string(round(totaldealImplementationCostTotalContract,2)));


put(MSTotalDealDict,"Total Deal Sales Cost"+"_Year1",string(totalDealcost1));
put(MSTotalDealDict,"Total Deal Sales Cost"+"_Year2",string(totalDealcost2));
put(MSTotalDealDict,"Total Deal Sales Cost"+"_Year3",string(totalDealcost3));
put(MSTotalDealDict,"Total Deal Sales Cost"+"_Year4",string(totalDealcost4));
put(MSTotalDealDict,"Total Deal Sales Cost"+"_Year5",string(totalDealcost5));
put(MSTotalDealDict,"Total Deal Sales Cost"+"_Year6",string(totalDealcost6));
put(MSTotalDealDict,"Total Deal Sales Cost"+"_Year7",string(totalDealcost7));
put(MSTotalDealDict,"Total Deal Sales Cost"+"_Total Contract",string(round(totaldealCostTotalContract,2)));

put(MSTotalDealDict,"Sales Cost GM"+"_Year1",string(totalGM1));
put(MSTotalDealDict,"Sales Cost GM"+"_Year2",string(totalGM2));
put(MSTotalDealDict,"Sales Cost GM"+"_Year3",string(totalGM3));
put(MSTotalDealDict,"Sales Cost GM"+"_Year4",string(totalGM4));
put(MSTotalDealDict,"Sales Cost GM"+"_Year5",string(totalGM5));
put(MSTotalDealDict,"Sales Cost GM"+"_Year6",string(totalGM6));
put(MSTotalDealDict,"Sales Cost GM"+"_Year7",string(totalGM7));
put(MSTotalDealDict,"Sales Cost GM"+"_Total Contract",string(round(totalGMTotalContract,2)));

//commented END_Post MVP CR#73 description by Namrata
/*print totalMarginPercent1;
ind = find(string(totalMarginPercent1) ,".");
val = substring(string(totalMarginPercent1 ) , 0, ind+3);
if(val <> "" or not (isnull(val))){
//print val;
totalMarginPercent1 = atof(val);
//print totalMarginPercent1 ;
}

ind = find(string(totalMarginPercent2) ,".");
val = substring(string(totalMarginPercent2 ) , 0, ind+3);
if(val<> "" or not (isnull(val))){

totalMarginPercent2 = atof(val);
}

ind = find(string(totalMarginPercent3) ,".");
val = substring(string(totalMarginPercent3 ) , 0, ind+3);
if(val <> "" or not (isnull(val))){
totalMarginPercent3 = atof(val);
}

ind = find(string(totalMarginPercent4) ,".");
val = substring(string(totalMarginPercent4 ) , 0, ind+3);
if(val <> "" or not (isnull(val))){
totalMarginPercent4 = atof(val);
}

ind = find(string(totalMarginPercent5) ,".");
val = substring(string(totalMarginPercent5 ) , 0, ind+3);
if(val <> "" or not (isnull(val))){
totalMarginPercent5 = atof(val);
}

ind = find(string(totalMarginPercent6) ,".");
val = substring(string(totalMarginPercent6 ) , 0, ind+3);
if(val <> "" or not (isnull(val))){

totalMarginPercent6 = atof(val);
}

ind = find(string(totalMarginPercent7) ,".");
val = substring(string(totalMarginPercent7) , 0, ind+3);
if(val<> "" or not (isnull(val))){
totalMarginPercent7 = atof(val);
}
*/
//commented END_Post MVP CR#73 description by Namrata
put(MSTotalDealDict,"Sales Cost Margin%"+"_Year1",string(round(totalMarginPercent1,2)));
put(MSTotalDealDict,"Sales Cost Margin%"+"_Year2",string(round(totalMarginPercent2,2)));
put(MSTotalDealDict,"Sales Cost Margin%"+"_Year3",string(round(totalMarginPercent3,2)));
put(MSTotalDealDict,"Sales Cost Margin%"+"_Year4",string(round(totalMarginPercent4,2)));
put(MSTotalDealDict,"Sales Cost Margin%"+"_Year5",string(round(totalMarginPercent5,2)));
put(MSTotalDealDict,"Sales Cost Margin%"+"_Year6",string(round(totalMarginPercent6,2)));
put(MSTotalDealDict,"Sales Cost Margin%"+"_Year7",string(round(totalMarginPercent7,2)));
put(MSTotalDealDict,"Sales Cost Margin%"+"_Total Contract",string(round(totalMarginTotalContract,2)));

if(param1 == "Price Analyst"){

put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Year1",string(totalMonthlyStandardCostYear1));
put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Year2",string(totalMonthlyStandardCostYear2));
put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Year3",string(totalMonthlyStandardCostYear3));
put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Year4",string(totalMonthlyStandardCostYear4));
put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Year5",string(totalMonthlyStandardCostYear5));
put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Year6",string(totalMonthlyStandardCostYear6));
put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Year7",string(totalMonthlyStandardCostYear7));
put(MSTotalDealDict,"Total Deal Recurring Standard Cost"+"_Total Contract",string(round(totalDealRecurringSTandardCostTotalContract,2)));

put(MSTotalDealDict,"Total Deal Standard Cost"+"_Year1",string(totalDealStandardcost1));
put(MSTotalDealDict,"Total Deal Standard Cost"+"_Year2",string(totalDealStandardcost2));
put(MSTotalDealDict,"Total Deal Standard Cost"+"_Year3",string(totalDealStandardcost3));
put(MSTotalDealDict,"Total Deal Standard Cost"+"_Year4",string(totalDealStandardcost4));
put(MSTotalDealDict,"Total Deal Standard Cost"+"_Year5",string(totalDealStandardcost5));
put(MSTotalDealDict,"Total Deal Standard Cost"+"_Year6",string(totalDealStandardcost6));
put(MSTotalDealDict,"Total Deal Standard Cost"+"_Year7",string(totalDealStandardcost7));
put(MSTotalDealDict,"Total Deal Standard Cost"+"_Total Contract",string(round(totalDealSTandardCostTotalContract,2)));


put(MSTotalDealDict,"Standard Cost GM"+"_Year1",string(totalStandardCostGMYear1));
put(MSTotalDealDict,"Standard Cost GM"+"_Year2",string(totalStandardCostGMYear2));
put(MSTotalDealDict,"Standard Cost GM"+"_Year3",string(totalStandardCostGMYear3));
put(MSTotalDealDict,"Standard Cost GM"+"_Year4",string(totalStandardCostGMYear4));
put(MSTotalDealDict,"Standard Cost GM"+"_Year5",string(totalStandardCostGMYear5));
put(MSTotalDealDict,"Standard Cost GM"+"_Year6",string(totalStandardCostGMYear6));
put(MSTotalDealDict,"Standard Cost GM"+"_Year7",string(totalStandardCostGMYear7));
put(MSTotalDealDict,"Standard Cost GM"+"_Total Contract",string(round(totalStandardGMTotalContract,2)));

put(MSTotalDealDict,"Standard Cost Margin%"+"_Year1",string(round(totalStandardCostMerginPerYear1,2)));
put(MSTotalDealDict,"Standard Cost Margin%"+"_Year2",string(round(totalStandardCostMerginPerYear2,2)));
put(MSTotalDealDict,"Standard Cost Margin%"+"_Year3",string(round(totalStandardCostMerginPerYear3,2)));
put(MSTotalDealDict,"Standard Cost Margin%"+"_Year4",string(round(totalStandardCostMerginPerYear4,2)));
put(MSTotalDealDict,"Standard Cost Margin%"+"_Year5",string(round(totalStandardCostMerginPerYear5,2)));
put(MSTotalDealDict,"Standard Cost Margin%"+"_Year6",string(round(totalStandardCostMerginPerYear6,2)));
put(MSTotalDealDict,"Standard Cost Margin%"+"_Year7",string(round(totalStandardCostMerginPerYear7,2)));
put(MSTotalDealDict,"Standard Cost Margin%"+"_Total Contract",string(round(StandardCostMarginPerTotalContract,2)));

}
// put(MSTotalDealDict,"Pricing Threshold Breach"+"_Total Contract",pricingThresholdBreachTotalContract);


	// REBATE  COMPONENTS============================
for eachData in resultSet{
	if(find(get(eachData,"SectionName"),"Rebate(s)") <> -1){
	itemDescription =get(eachData,"Item");	
		if(find(itemDescription,"Rebate($)") <> -1){
		rebateCostValueOneTime = 0.0;
		rebateCostValue = 0.0;
		rebateCostValue7= 0.0;
		rebateCostValue1=0.0;
		rebateCostValue2=0.0;
		rebateCostValue3=0.0;
		rebateCostValue4=0.0;
		rebateCostValue5=0.0;
		rebateCostValue6=0.0;
		
		if(rebateType_t == "directPayment" AND rebateValueOption_t == "rebateValue" AND rebateGPOThirdparty_t == ""){
			
			if(rebateApplied_t == "oneTime"){
			rebateCostValueOneTime = rebateDollarMonthly;
			}else{
			rebateCostValue = rebateDollarMonthly;
			}
			
		}else{
			
		   rebateCostValue1 = (totalMonthlyRevenueYear1*rebatePrecentage/100);
			if(year2Flag){
			rebateCostValue2 = (totalMonthlyRevenueYear2*rebatePrecentage/100);	
			}
			if(year3Flag){
			rebateCostValue3 = (totalMonthlyRevenueYear3*rebatePrecentage/100);	
			
			}
			if(year4Flag){
			rebateCostValue4 = (totalMonthlyRevenueYear4*rebatePrecentage/100);	
			}
			if(year5Flag){
			rebateCostValue5 = (totalMonthlyRevenueYear5*rebatePrecentage/100);	
			}
			if(year6Flag){
				
			rebateCostValue6 = (totalMonthlyRevenueYear6*rebatePrecentage/100);	
			}
			if(year7Flag){
			rebateCostValue7 = (totalMonthlyRevenueYear7*rebatePrecentage/100);	
			}
		
		}
		
		put(PricingDict,itemDescription+"_Year1",(rebateCostValue*termFactorYear1)+rebateCostValueOneTime+rebateCostValue1);
		totalRebateCost = (rebateCostValue*termFactorYear1)+rebateCostValueOneTime+rebateCostValue1;
		
		if(year2Flag){
			
			put(PricingDict,itemDescription+"_Year2",(rebateCostValue*termFactorYear2)+rebateCostValue2);
			totalRebateCost =totalRebateCost+ (rebateCostValue*termFactorYear2)+rebateCostValue2;
			
		}
		if(year3Flag){
			
			put(PricingDict,itemDescription+"_Year3",(rebateCostValue*termFactorYear3)+rebateCostValue3);
			totalRebateCost =totalRebateCost+ (rebateCostValue*termFactorYear3)+rebateCostValue3;

			
		}
			
		if(year4Flag){
			//rebateCostValue = totalContractRevenueY4*rebatePrecentage/100;
				// rebateCostValue = rebateDollarMonthly;
			put(PricingDict,itemDescription+"_Year4",(rebateCostValue*termFactorYear4)+rebateCostValue4);
			totalRebateCost =totalRebateCost+ (rebateCostValue*termFactorYear4)+rebateCostValue4;
			
		}
		if(year5Flag){
			//rebateCostValue = totalContractRevenueY5*rebatePrecentage/100;
				//rebateCostValue = rebateDollarMonthly;
			put(PricingDict,itemDescription+"_Year5",(rebateCostValue*termFactorYear5)+rebateCostValue5);
			totalRebateCost =totalRebateCost+ (rebateCostValue*termFactorYear5)+rebateCostValue5;
		}
		
		if(year6Flag){
			//rebateCostValue = totalContractRevenueY6*rebatePrecentage/100;
				//rebateCostValue = rebateDollarMonthly;
			put(PricingDict,itemDescription+"_Year6",(rebateCostValue*termFactorYear6)+rebateCostValue6);
			totalRebateCost =totalRebateCost+ (rebateCostValue*termFactorYear6)+rebateCostValue6;
		}
		
		if(year7Flag){
			//rebateCostValue = totalContractRevenueY7*rebatePrecentage/100;
				//rebateCostValue = rebateDollarMonthly;
			put(PricingDict,itemDescription+"_Year7",(rebateCostValue*termFactorYear7)+rebateCostValue7);
			totalRebateCost =totalRebateCost+ (rebateCostValue*termFactorYear7)+rebateCostValue7;
		}

		
			put(PricingDict,ItemDescription+"_Total Contract",totalRebateCost);
		}elif(find(itemDescription,"Rebate%") <> -1){
				
			put(PricingDict,itemDescription+"_Year1",rebatePrecentage);
			
			
			if(year2Flag){
				
				
				put(PricingDict,itemDescription+"_Year2",rebatePrecentage);
			}
			if(year3Flag){
			
				put(PricingDict,itemDescription+"_Year3",rebatePrecentage);

				
			}
			
			if(year4Flag){
				
				put(PricingDict,itemDescription+"_Year4",rebatePrecentage);

			}
			if(year5Flag){
				
				put(PricingDict,itemDescription+"_Year5",rebatePrecentage);
			}
			
			if(year6Flag){
				
				put(PricingDict,itemDescription+"_Year6",rebatePrecentage);
			}
			
			if(year7Flag){
			
				put(PricingDict,itemDescription+"_Year7",rebatePrecentage);
			}
			
			put(PricingDict,ItemDescription+"_Total Contract",rebatePrecentage);
		}
	
	}
}	

print "DDIOCT______";
print MSTotalDealDict;	
			
//---------------REBATE END-------------------------------------------------------------------		

rowCounter =0;
// code to populate total MS deal----------------
MSTotalDealJsonSalesMarginJson = json();
for eachVal in MSTotalDealRowListArray{
	
	totalContractMSTotal = "";
	year1MSTotal = "0.0";
	year2MSTotal = "0.0";
	year3MSTotal = "0.0";
	year4MSTotal = "0.0";
	year5MSTotal = "0.0";
	year6MSTotal = "0.0";
	year7MSTotal = "0.0";
	MSTotalContractValue = "0.0";
	if((param1 == "" AND find(eachVal,"Standard Cost") == -1) OR (param1 == "Price Analyst")){
	jsonput(MSTotalDealJson, "mSTotalDealRows_ArraySet",eachVal);
	// Print "eachVal--";
	// print eachVal;
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Year1")))){
	year1MSTotal= get(MSTotalDealDict,eachVal+"_Year1");
	
	//HYPERCARE changes CR#11 description by Namrata
	if(year1MSTotal<> "" AND not(isnull(year1MSTotal))){
		FirstYearPIMAGP=atof(year1MSTotal);
		}
	}
	
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Year2")))){
	year2MSTotal= get(MSTotalDealDict,eachVal+"_Year2");
	}
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Year3")))){
	year3MSTotal= get(MSTotalDealDict,eachVal+"_Year3");
	}
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Year4")))){
	year4MSTotal= get(MSTotalDealDict,eachVal+"_Year4");
	}
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Year5")))){
	year5MSTotal= get(MSTotalDealDict,eachVal+"_Year5");
	}
	
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Year6")))){
	year6MSTotal= get(MSTotalDealDict,eachVal+"_Year6");
	}
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Year7")))){
	year7MSTotal= get(MSTotalDealDict,eachVal+"_Year7");
	}
	
	if(not(isnull(get(MSTotalDealDict,eachVal+"_Total Contract")))){
		MSTotalContractValue =  get(MSTotalDealDict,eachVal+"_Total Contract");
	}
	// added string attribute to manage format issues
	totalContractMSTotal  = formatascurrency(round(atof(MSTotalContractValue),2), "USD");
	
	if(eachVal == "Sales Cost Margin%"){
		
		print "year1MSTotal----";
		print year1MSTotal;
		print year2MSTotal;
		print year3MSTotal;
		print year4MSTotal;
		print year5MSTotal;
		jsonput(MSTotalDealJsonSalesMarginJson, "year1_MSTotalArraySet",year1MSTotal);
	jsonput(MSTotalDealJsonSalesMarginJson, "year2_MSTotalArraySet",year2MSTotal);
	jsonput(MSTotalDealJsonSalesMarginJson, "year3_MSTotalArraySet", year3MSTotal);
	jsonput(MSTotalDealJsonSalesMarginJson, "year4_MSTotalArraySet", year4MSTotal);
	jsonput(MSTotalDealJsonSalesMarginJson, "year5_MSTotalArraySet",year5MSTotal);
	jsonput(MSTotalDealJsonSalesMarginJson, "year6_MSTotalArraySet", year6MSTotal);
	jsonput(MSTotalDealJsonSalesMarginJson, "year7_MSTotalArraySet",year7MSTotal);
	jsonput(MSTotalDealJsonSalesMarginJson, "totalContract_MSTotalArraySet",substring(totalContractMSTotal,1,len(totalContractMSTotal)));
	jsonput(MSTotalDealJsonSalesMarginJson, "totalContractFloat_MSTotalArraySet",MSTotalContractValue); 
	}
	jsonput(MSTotalDealJson, "year1_MSTotalArraySet",year1MSTotal);
	jsonput(MSTotalDealJson, "year2_MSTotalArraySet",year2MSTotal);
	jsonput(MSTotalDealJson, "year3_MSTotalArraySet", year3MSTotal);
	jsonput(MSTotalDealJson, "year4_MSTotalArraySet", year4MSTotal);
	jsonput(MSTotalDealJson, "year5_MSTotalArraySet",year5MSTotal);
	jsonput(MSTotalDealJson, "year6_MSTotalArraySet", year6MSTotal);
	jsonput(MSTotalDealJson, "year7_MSTotalArraySet",year7MSTotal);
	jsonput(MSTotalDealJson, "totalContract_MSTotalArraySet",substring(totalContractMSTotal,1,len(totalContractMSTotal)));
	jsonput(MSTotalDealJson, "totalContractFloat_MSTotalArraySet",MSTotalContractValue); 	//Added - HYPERCARE_CR046# “PIMA Header Details - Chakri
	
	// added string attribute to manage format issues
	year1MSTotalStr  = formatascurrency(round(atof(year1MSTotal),2), "USD");
	year2MSTotalStr =  formatascurrency(round(atof(year2MSTotal),2), "USD");
	year3MSTotalStr =  formatascurrency(round(atof(year3MSTotal),2), "USD");
	year4MSTotalStr =  formatascurrency(round(atof(year4MSTotal),2), "USD");
	year5MSTotalStr = formatascurrency(round(atof(year5MSTotal),2), "USD");
	year6MSTotalStr =  formatascurrency(round(atof(year6MSTotal),2), "USD");
	year7MSTotalStr = formatascurrency(round(atof(year7MSTotal),2), "USD");

	jsonput(MSTotalDealJson, "year1_MSTotalArrayStrSet",substring(year1MSTotalStr,1,len(year1MSTotalStr)));
	jsonput(MSTotalDealJson, "year2_MSTotalArrayStrSet",substring(year2MSTotalStr,1,len(year2MSTotalStr)));
	jsonput(MSTotalDealJson, "year3_MSTotalArrayStrSet", substring(year3MSTotalStr,1,len(year3MSTotalStr)));
	jsonput(MSTotalDealJson, "year4_MSTotalArrayStrSet", substring(year4MSTotalStr,1,len(year4MSTotalStr)));
	jsonput(MSTotalDealJson, "year5_MSTotalArrayStrSet",substring(year5MSTotalStr,1,len(year5MSTotalStr)));
	jsonput(MSTotalDealJson, "year6_MSTotalArrayStrSet", substring(year6MSTotalStr,1,len(year6MSTotalStr)));
	jsonput(MSTotalDealJson, "year7_MSTotalArrayStrSet",substring(year7MSTotalStr,1,len(year7MSTotalStr)));
	
	jsonarrayappend(MSTotalDealArray, MSTotalDealJson);
	}
}	

// print "MSTotalDealArray--";
// print MSTotalDealArray;
salesCostMarginDict = dict("string");
levelArr = string[];
levelEscArr = string[];
retValLevel = "";
retValEscLevel = "";
yearsBreachedVal = "";
yearsBreachedforEmail = "";
yearsEscBreachedVal = "";
yearsEscBreachedforEmail = "";
yearDict = dict("float");
yearEscDict = dict("float");
index = 1;
rowDelim = "@$@";
colDelim = "#$#";
pimaArrayString = "";
//code added by Rohit for CHG0086584 to trigger pricing approvals for cont term less than 12 months
if(contractTerm<12){
	if(NOT isnull(jsonget(MSTotalDealJsonSalesMarginJson,"year1_MSTotalArraySet"))){
		put(salesCostMarginDict, "year1", jsonget(MSTotalDealJsonSalesMarginJson,"year1_MSTotalArraySet"));
	}

}
//code end by Rohit for CHG0086584

arraysize = range(contractTerm/12);
for each in arraysize {
	if(NOT isnull(jsonget(MSTotalDealJsonSalesMarginJson,"year"+string(each+1)+"_MSTotalArraySet"))){
		put(salesCostMarginDict, "year"+string(each+1), jsonget(MSTotalDealJsonSalesMarginJson,"year"+string(each+1)+"_MSTotalArraySet"));
	}
}



salesCostMarginArr = keys(salesCostMarginDict);


tempArray = sort(salesCostMarginArr); // There is issues in production related to sequence 

print "tempArray-2146--";
print tempArray;
for each in tempArray {
	

	marginQuoteSummary = get(salesCostMarginDict,each);
	if(marginQuoteSummary <> ""){
		marginFactor = atof(marginQuoteSummary);
		marginFactor = round(marginFactor , 2); // code uncommented Defect # 18455
	}
	//approverTable = BMQL("SELECT PricingApprovalLevel, LowerMargin, UpperMargin FROM MS_ApprovalMrg where ApprovalType = 'Deal'");
	
	for eachRow in approverTable {
		if(get(eachRow, "ApprovalType") == "Deal"){
			level = get(eachRow, "PricingApprovalLevel");
			lowerMargin = get(eachRow, "LowerMargin");
			upperMargin = get(eachRow, "UpperMargin");
			if(lowerMargin <> "" AND lowerMargin <>""){
			//print "margin factor"; print string(marginFactor);

				if(marginFactor > atof(lowerMargin) AND marginFactor <= atof(upperMargin)){
				Print " iam here MS --"; 
					print marginFactor;
					print lowerMargin;
					print upperMargin;
					print level;
					print "----";
					append(levelArr, level);//put(yearDict, "Year"+string(index),marginFactor);
					break;
				}
			}
		}
	}
}


// ---------Total margin threshold breach Last row of deal margin table-----------------
	if(not(isnull(levelArr[0]))){
		pricingThresholdBreachY1 = levelArr[0];
	}
	if(not(isnull(levelArr[1]))){
		pricingThresholdBreachY2 = levelArr[1];
	}
	if(not(isnull(levelArr[2]))){
		pricingThresholdBreachY3 = levelArr[2];
	}
	if(not(isnull(levelArr[3]))){
		pricingThresholdBreachY4 = levelArr[3];
	}
	if(not(isnull(levelArr[4]))){
		pricingThresholdBreachY5 = levelArr[4];
	}
	if(not(isnull(levelArr[5]))){
		pricingThresholdBreachY6 = levelArr[5];
	}
	if(not(isnull(levelArr[6]))){
		pricingThresholdBreachY7 = levelArr[6];
	}
	
	// MSTotalDealJson1 = json();
		
	// jsonput(MSTotalDealJson1, "mSTotalDealRows_ArraySet","Pricing Threshold Breach");
	// jsonput(MSTotalDealJson1, "year1_MSTotalArraySet",pricingThresholdBreachY1);
	// jsonput(MSTotalDealJson1, "year2_MSTotalArraySet",pricingThresholdBreachY2);
	// jsonput(MSTotalDealJson1, "year3_MSTotalArraySet", pricingThresholdBreachY3);
	// jsonput(MSTotalDealJson1, "year4_MSTotalArraySet", pricingThresholdBreachY4);
	// jsonput(MSTotalDealJson1, "year5_MSTotalArraySet",pricingThresholdBreachY5);
	// jsonput(MSTotalDealJson1, "year6_MSTotalArraySet", pricingThresholdBreachY6);
	// jsonput(MSTotalDealJson1, "year7_MSTotalArraySet",pricingThresholdBreachY7);
	// jsonarrayappend(MSTotalDealArray, MSTotalDealJson1);
//---------
// setup Pricing Approval Level 
if(findinarray(levelArr, "Level 3") > -1){
	retValLevel = "Level 3";
	append(L3ReviewLevelArray,"Level 3 Pricing");
}elif(findinarray(levelArr, "Level 2") > -1){
	retValLevel = "Level 2";
}elif(findinarray(levelArr, "Level 1") > -1){
	retValLevel = "Level 1";
}


// res = res + "1~mSPricingApproverLevel_t~" + retValLevel + "|";
setattributevalue(1,"mSPricingApproverLevel_t",retValLevel);
print "pricing level check" +retValLevel;
	

//HYPERCARE-CR_CHG#0082000_CR#55_DescriptionOfChange_by Namrata

if(lower(mSTransactionType_t) <> "expansion" AND mSTransactionType_t <> "Expansion (New Location)"){

//Start_HYPERCARE-CR_CHG#0082000_CR#41_Description_by Namrata
if(containsMSItems){ // code to run only for MS Lines.
id = 1;
annualescalationArr = string[];
	if(variableAnnualRevenueEscalation_t == true){
		sizeArray = integer[7];
		j = 1;
		for i in sizeArray{
			annualEscalationVar = (jsonget(json(jsonarrayget(variableAnnualEscalationArraySet_t, 0)),"year"+string(j)));
			append(annualescalationArr, annualEscalationVar);
			j= j+1;

			}
		
		for eachEsc in annualescalationArr{
			for eachRow in approverTable{
				if(get(eachRow, "ApprovalType") == "Escalation"){
					level = get(eachRow, "PricingApprovalLevel");
					lowerMargin = get(eachRow, "LowerMargin");
					upperMargin = get(eachRow, "UpperMargin");
					if(lowerMargin <> "" AND lowerMargin <>""){
						if(eachEsc <> "" AND not(isnull(eachEsc ))){
						eachEscFloat = atof(eachEsc);
						
						if(eachEscFloat > atof(lowerMargin) AND eachEscFloat <= atof(upperMargin) AND eachEscFloat <>0){
							retValEscLevel = level;
							put(yearEscDict, "Year"+string(id),eachEscFloat);
							append(levelEscArr, retValEscLevel);
							break;
							}
						}  
					}
				}
		}
		id = id+1;
	}
}
	//approverTable = BMQL("SELECT PricingApprovalLevel, LowerMargin, UpperMargin FROM MS_ApprovalMrg where ApprovalType = 'Escalation'");
	else{
		for eachRow in approverTable {
		if(get(eachRow, "ApprovalType") == "Escalation"){
			level = get(eachRow, "PricingApprovalLevel");
			lowerMargin = get(eachRow, "LowerMargin");
			upperMargin = get(eachRow, "UpperMargin");
			if(lowerMargin <> "" AND lowerMargin <>""){
				if(annualRevenueEscalation_t > atof(lowerMargin) AND annualRevenueEscalation_t <= atof(upperMargin)){
					retValEscLevel = level;
					break;
					}
				}
			}
		}
	}

	if(variableAnnualRevenueEscalation_t == true){
		if(findinarray(levelEscArr, "Level 3") > -1){
			retValEscLevel = "Level 3";
			append(L3ReviewLevelArray,"Level 3 Escalation");
		}elif(findinarray(levelEscArr, "Level 2") > -1){
			retValEscLevel = "Level 2";
		}elif(findinarray(levelEscArr, "Level 1") > -1){
			retValEscLevel = "Level 1";
		}
	}
	else {
		if(retValEscLevel == "Level 3"){
		append(L3ReviewLevelArray,"Level 3 Escalation");
		}
	}
	
	res = res + "1~mSPricingApproverEscalationLevel_t~" + retValEscLevel + "|";
	
}
else {	
	res = res + "1~mSPricingApproverEscalationLevel_t~" + "|"; 
	}
}
//END_HYPERCARE-CR_CHG#0082000_CR#41_DescriptionOfChange_by Namrata

//-------------------- Find Level Factor based on year deal---------------
//approverTable = BMQL("SELECT PricingApprovalLevel,ApprovalType, LowerMargin, UpperMargin FROM MS_ApprovalMrg where PricingApprovalLevel = $retValLevel AND ApprovalType = 'Deal'");

//-------------------- Find Level Factor based on year deal---------------
salesCostMarginArr = keys(salesCostMarginDict);
salesCostMarginArr = sort(salesCostMarginArr );
for each in salesCostMarginArr {
	pimaArrayString = pimaArrayString + each + rowDelim + get(salesCostMarginDict, each) + colDelim; 
	marginQuoteSummary = get(salesCostMarginDict,each);
	if(marginQuoteSummary <> ""){
		marginFactor = atof(marginQuoteSummary);
		marginFactor = round(marginFactor , 2); // code uncommemted Defect # 18455
	}
	for eachRow in approverTable {
		
		if(get(eachRow, "PricingApprovalLevel") == retValLevel AND get(eachRow, "ApprovalType") == "Deal"){
			lowerMargin = get(eachRow, "LowerMargin");
			upperMargin = get(eachRow, "UpperMargin");
			if(lowerMargin <> "" AND lowerMargin <>""){
				if(marginFactor > atof(lowerMargin) AND marginFactor <= atof(upperMargin)){
					put(yearDict, "Year"+string(index),marginFactor);
					break;
				}
			}
		}
		
	}
	index = index + 1;
}

// set the Review Emails from the Pricing Approval table.

for eachRow in approverTable {
		
	if(findinarray(L3ReviewLevelArray,get(eachRow, "PricingApprovalLevel")) <> -1 AND get(eachRow, "ApproverTriggerLevel") == "Level 3 Notification"){
		
		L3ReviewEmailIds = L3ReviewEmailIds + get(eachRow, "EmailID") + ";" ;
	
	}
}
	
	res = res + "1~pricingL3ReviewerEmail_t~" + L3ReviewEmailIds + "|";
// ------------------------------------------------------
yearArray = keys(yearDict);
yearArray = sort(yearArray);
for each in yearArray {
	if(each <> ""){
		yearsBreachedVal = yearsBreachedVal + each + rowDelim + string(get(yearDict, each)) + colDelim ;
		yearsBreachedforEmail = yearsBreachedforEmail + each + "," ;
	}
}
if(len(yearsBreachedVal) > len(colDelim)){
	yearsBreachedVal = substring(yearsBreachedVal, 0, len(yearsBreachedVal) - len(colDelim));
}
if(len(yearsBreachedforEmail) > len(",")){
	yearsBreachedforEmail = substring(yearsBreachedforEmail, 0, len(yearsBreachedforEmail) - len(","));
}

if(len(pimaArrayString) > len(colDelim)){
	pimaArrayString = substring(pimaArrayString, 0, len(pimaArrayString) - len(colDelim));
}
yearEscArray = keys(yearEscDict);
yearEscArray = sort(yearEscArray);
for each1 in yearEscArray {
	if(each1 <> ""){
		yearsEscBreachedVal = yearsEscBreachedVal + each1 + rowDelim + string(get(yearEscDict, each1)) + colDelim ;
		
		yearsEscBreachedforEmail = yearsEscBreachedforEmail + each1 + "," ;
		
	}
}
if(len(yearsEscBreachedVal) > len(colDelim)){
	yearsEscBreachedVal = substring(yearsEscBreachedVal, 0, len(yearsEscBreachedVal) - len(colDelim));
}
if(len(yearsEscBreachedforEmail) > len(",")){
	yearsEscBreachedforEmail = substring(yearsEscBreachedforEmail, 0, len(yearsEscBreachedforEmail) - len(","));
}

res = res + "1~mSPricingApproverYearsBreached_t~" + yearsBreachedVal + "|";
res = res + "1~mpsLabourYearsBreached_t_c~" + yearsBreachedVal + "|";
res = res + "1~msLabourYearsBreached_t_c~" + yearsBreachedVal + "|";
res = res + "1~tassLabourYearsBreached_t_c~" + yearsBreachedVal + "|";
res = res + "1~iTSLabourYearsBreached_t_c~" + yearsBreachedVal + "|";
res = res + "1~mSYearsBreachedForEmail_t~" + yearsBreachedforEmail + "|";
res = res + "1~mSTotalDealSectionArrayString_t~" + pimaArrayString + "|";
if(containsMSItems){
res = res + "1~mSEscalationApproverYearsBreached_t~" + yearsEscBreachedVal + "|";
res = res + "1~mSYearsEscBreachedForEmail_t~" + yearsEscBreachedforEmail + "|";
}

//START_HYPERCARE-CR_CHG#0082000_CR#33_DescriptionOfChange_by Namrata
errorMessageDict = dict("string");
recordSet = bmql("select MESSAGE_NAME,MESSAGE_TEXT from RAC_ErrorMessages where ACTIVE = 'Y'");
	for each in recordSet{
		put(errorMessageDict,get(each,"MESSAGE_NAME"),get(each,"MESSAGE_TEXT"));
	}
//END_HYPERCARE-CR_CHG#0082000_CR#33_DescriptionOfChange_by Namrata

pricingApprovalWarningMsg = "";
if(containsMSItems){ //Defect 17781 - Added if Condition to display below message only when MS lines are present
	pricingApprovalWarningMsg = "<html><body><table>";
	if(yearsBreachedVal <>""){
	
	//START_HYPERCARE-CR_CHG#0082000_CR#33_DescriptionOfChange_by Namrata
	print "retValLevel---";
	print retValLevel;
	if(retValLevel == "Level 1"){
		pricingApprovalWarningMsg = pricingApprovalWarningMsg +"<tr><td><ul>" +get(errorMessageDict,"MS_Level1_Pricing_Error") +" "+get(errorMessageDict,"MS_Level1_Threshold")+"</ul></td> </tr>";
	}
	if(retValLevel == "Level 2"){
		pricingApprovalWarningMsg = pricingApprovalWarningMsg+"<tr><td><ul>" +get(errorMessageDict,"MS_Level1_Pricing_Error") +" "+get(errorMessageDict,"MS_Level2_Threshold")+"</ul></td> </tr>";
	}
	if(retValLevel == "Level 3"){
		pricingApprovalWarningMsg = pricingApprovalWarningMsg+"<tr><td><ul>" +get(errorMessageDict,"MS_Level1_Pricing_Error") +" "+get(errorMessageDict,"MS_Level3_Threshold")+"</ul></td> </tr>";
	}
	pricingApprovalWarningMsg = replace(pricingApprovalWarningMsg,"{{YearsBreached}}",yearsBreachedforEmail);
	pricingApprovalWarningMsg = replace(pricingApprovalWarningMsg,"{{FindLevel}}",retValLevel );
	//END_HYPERCARE-CR_CHG#0082000_CR#33_DescriptionOfChange_by Namrata
	}
	if(retValEscLevel <> ""){ 
		pricingApprovalWarningMsg = pricingApprovalWarningMsg + "<tr><td><ul>This Quote Requires Annual Escalation Approval due to quote level Annual Escalation value threshold being breached.</ul></td> </tr>";
	}
	pricingApprovalWarningMsg = pricingApprovalWarningMsg + " </table></body></html>";
}
print "-------2436 MS PIMA ---";
print pricingApprovalWarningMsg;
res = res + "1~mSPricingApprovalNote_t~" + pricingApprovalWarningMsg + "|";

ExcludeArray = string[]{"Rebate","MS Total"};
totalfirstMonthRevenue = 0.0;
totalFirstMonthCost =0.0;
totalfirstMonthMargin=0.0;
firstMonthRevenueCost = 0.0;
firstMonthRevenueVal = 0.0;
MarginVal = 0.0 ;

for eachData in firstMonthBillingRowListArray{


firstMonthRevenueVal = 0.0;
// firstMonthRevenueCost = 0.0;
// MarginVal = 0.0;
	if(findinarray(ExcludeArray,eachData) == -1){
		if(not(isnull(get(pricingDict,eachData+"_Month1_REV")))){
		firstMonthRevenueVal=get(pricingDict,eachData+"_Month1_REV");
		}
		// if(not(isnull(get(pricingDict,eachData+"_Month1_COST")))){
		// firstMonthRevenueCost=get(pricingDict,eachData+"_Month1_COST");
		// }
		totalfirstMonthRevenue = totalfirstMonthRevenue +firstMonthRevenueVal;
		// totalFirstMonthCost = totalFirstMonthCost +firstMonthRevenueCost;
		// if(firstMonthRevenueVal <> 0.0){
		
		// MarginVal = ((firstMonthRevenueVal - firstMonthRevenueCost)/firstMonthRevenueVal)*100;
		// }
		
		
		jsonput(firstMonthBillingJson, "managedServicesComponents_FirstMonthBilling",eachData);

		jsonput(firstMonthBillingJson, "month1Revenue_FirstMonthBilling", firstMonthRevenueVal);
		// jsonput(firstMonthBillingJson, "month1Costs_FirstMonthBilling",firstMonthRevenueCost);
		// jsonput(firstMonthBillingJson, "month1Margin_FirstMonthBilling", MarginVal);

	}
	elif(eachData == "MS Total"){
		// if(totalfirstMonthRevenue <> 0.0){
		// totalfirstMonthMargin = (totalfirstMonthRevenue-totalFirstMonthCost)/totalfirstMonthRevenue*100;
		// }
		jsonput(firstMonthBillingJson, "managedServicesComponents_FirstMonthBilling",eachData);
		
		jsonput(firstMonthBillingJson, "month1Revenue_FirstMonthBilling", totalfirstMonthRevenue);
		//HYPERCARE changes CR#11 description by Namrata
		FirstMonthPaymentPIMA= totalfirstMonthRevenue;
		// jsonput(firstMonthBillingJson, "month1Costs_FirstMonthBilling",totalFirstMonthCost);
		// jsonput(firstMonthBillingJson, "month1Margin_FirstMonthBilling", totalfirstMonthMargin);
		
	}elif(eachData == "Rebate"){
		jsonput(firstMonthBillingJson, "managedServicesComponents_FirstMonthBilling",eachData);

		jsonput(firstMonthBillingJson, "month1Revenue_FirstMonthBilling", 0.0);
		// jsonput(firstMonthBillingJson, "month1Costs_FirstMonthBilling",0.0);
		// jsonput(firstMonthBillingJson, "month1Margin_FirstMonthBilling", 0.0);
	}
	jsonarrayappend(firstMonthBillingArray, firstMonthBillingJson);
}

// Iterating on the Pima data table to match the price 
for eachData in resultSet{
	MSLaborYear1Val = 0.0;
		MSLaborYear2Val = 0.0;
		MSLaborYear3Val = 0.0;
		MSLaborYear4Val = 0.0;
		MSLaborYear5Val = 0.0;
			MSLaborYear6Val = 0.0;
		MSLaborYear7Val = 0.0;
		MSLaborTotalContract= 0.0;
		sectionName = get(eachData,"SectionName");
		ItemName = get(eachData,"Item");
	// Populate MS Labor component table-----------
	
	if((param1 == "" AND find(ItemName,"Standard Cost") == -1) OR (param1 == "Price Analyst")){
		if(sectionName == "MS Labor"){
			
			// created util library to populate component Arrays - Code Optimization.
			
			MSLaborPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", MSLaborPIMAJson);
			jsonarrayappend(MSPIMAArray,MSLaborPIMAJson);
			
		}
		// Populate MPS Labor component table
		if(get(eachData,"SectionName") == "MPS Labor"){
			
			// created util library to populate component Arrays - Code Optimization.
			MPSLaborPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", MPSLaborPIMAJson);
			
			jsonarrayappend(MPSPIMAArray,MPSLaborPIMAJson);
			
			
		}
		// Populate ITS Labor component table
		if(get(eachData,"SectionName") == "ITS Labor"){
			// created util library to populate component Arrays - Code Optimization.
			ITSLaborPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", ITSLaborPIMAJson);
			
			jsonarrayappend(ITSPIMAArray,ITSLaborPIMAJson);
				
		}
		// Populate TASS Labor component table
		if(get(eachData,"SectionName") == "TASS Labor"){
			TASSLaborPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", TASSLaborPIMAJson);
			jsonarrayappend(TASSPIMAArray,TASSLaborPIMAJson);
		
		}
		// Populate VEHiCLE Component Table
		if(get(eachData,"SectionName") == "Vehicle"){
			VehiclePIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", VehiclePIMAJson);
			
			jsonarrayappend(VehiclePIMAArray,VehiclePIMAJson);
		}
		
		// Populate TRAC Item Table
		if(get(eachData,"SectionName") == "TRAC"){
		
			
			TRACPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", TRACPIMAJson);
			jsonarrayappend(TRACPIMAArray,TRACPIMAJson);
		}
		
		// Populate Other services  third party  table 
		if(get(eachData,"SectionName") == "3rd Party"){
			
			otherServicesPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", otherServicesPIMAJson);
			
			jsonarrayappend(OtherSerPIMAArray,otherServicesPIMAJson);
		}
		
		
		// Populate Other services Non third party  table 
		if(get(eachData,"SectionName") == "Non 3rd Party"){
			
			otherServicesNTPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", otherServicesNTPIMAJson);

			jsonarrayappend(OtherSerNTPIMAArray,otherServicesNTPIMAJson);
		}
		
		// Populate PS in MS  table 
		if(get(eachData,"SectionName") == "PS in MS"){
			
			PSPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", PSPIMAJson);

			jsonarrayappend(PSPIMAArray,PSPIMAJson);
		}
	// Populate Mailroom solution table 
		if(get(eachData,"SectionName") == "Mailroom Solutions"){
			MailRoomPIMAJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", MailRoomPIMAJson);
			jsonarrayappend(mailRoomPIMAArray,MailRoomPIMAJson);
		}
		

	//Rebate Json Array
			if(get(eachData,"SectionName") == "Rebate(s)"){
				
				rebateTotalJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", rebateTotalJson);
				jsonarrayappend(rebateTotalArray,rebateTotalJson);
			}
	//Area cost Json array 
			if(get(eachData,"SectionName") == "Area Costs (Phone/PC)"){
				areaCostJson= util.pIMAComponentArrayGeneration(sectionName, ItemName, PricingDict, "", areaCostJson);
				jsonarrayappend(areaCostArray,areaCostJson);
			}
	}
}

	


//----------------------------------------------
// GP Message Generation--------

//start_CPQ_BAU_CHG0087174_CREATED_BY_gowtham_01-11-2024
//populate years breach for labour(MS,MPS,ITS,TASS)
salesCostMarginDict = dict("string");
mslaboursalesCostMarginDict = dict("string");
mpslaboursalesCostMarginDict = dict("string");
itslaboursalesCostMarginDict = dict("string");
tasslaboursalesCostMarginDict = dict("string");
mslabourpimaArrayString = "";
tasslabourpimaArrayString = "";
mpslabourpimaArrayString = "";
itslabourpimaArrayString = "";
if(contractTerm<12){
	if(NOT isnull(jsonget(MSLaborPIMAJson,"	mSLaborYear1FloatPIMAArray_t"))){
		put(mslaboursalesCostMarginDict, "year1", jsonget(MSLaborPIMAJson,"	mSLaborYear1FloatPIMAArray_t"));
	}
	
	if(NOT isnull(jsonget(MPSLaborPIMAJson,"mPSLaborYear1FloatPIMAArray_t"))){
		put(mpslaboursalesCostMarginDict, "year1", jsonget(MPSLaborPIMAJson,"mPSLaborYear1FloatPIMAArray_t"));
	}
	if(NOT isnull(jsonget(ITSLaborPIMAJson,"iTSYear1FloatPIMAArray_t"))){
		put(itslaboursalesCostMarginDict, "year1", jsonget(ITSLaborPIMAJson,"iTSYear1FloatPIMAArray_t"));
	}
	if(NOT isnull(jsonget(TASSLaborPIMAJson,"tASSYear1PIMAArray_t"))){
		put(tasslaboursalesCostMarginDict, "year1", jsonget(TASSLaborPIMAJson,"tASSYear1PIMAArray_t"));
	}
	

}
arraysize = range(contractTerm/12);
for each in arraysize {
	if(NOT isnull(jsonget(MSLaborPIMAJson,"mSLaborYear"+string(each+1)+"FloatPIMAArray_t"))){
		put(mslaboursalesCostMarginDict, "year"+string(each+1), jsonget(MSLaborPIMAJson,"mSLaborYear"+string(each+1)+"FloatPIMAArray_t"));
	}
	if(NOT isnull(jsonget(MPSLaborPIMAJson,"mPSLaborYear"+string(each+1)+"FloatPIMAArray_t"))){
		put(mpslaboursalesCostMarginDict, "year"+string(each+1), jsonget(MPSLaborPIMAJson,"mPSLaborYear"+string(each+1)+"FloatPIMAArray_t"));
	}
	if(NOT isnull(jsonget(ITSLaborPIMAJson,"iTSYear"+string(each+1)+"FloatPIMAArray_t"))){
		put(itslaboursalesCostMarginDict, "year"+string(each+1), jsonget(ITSLaborPIMAJson,"iTSYear"+string(each+1)+"FloatPIMAArray_t"));
	}
	if(NOT isnull(jsonget(TASSLaborPIMAJson,"tASSYear"+string(each+1)+"PIMAArray_t"))){
		put(tasslaboursalesCostMarginDict, "year"+string(each+1), jsonget(TASSLaborPIMAJson,"tASSYear"+string(each+1)+"PIMAArray_t"));
	}
}
mslaboursalesCostMarginArr = keys(mslaboursalesCostMarginDict);
mpslaboursalesCostMarginArr = keys(mpslaboursalesCostMarginDict);
itslaboursalesCostMarginArr = keys(itslaboursalesCostMarginDict);
tasslabooursalesCostMarginArr = keys(tasslaboursalesCostMarginDict);
for each in mpslaboursalesCostMarginArr{
	mpslabourpimaArrayString = mpslabourpimaArrayString + each + rowDelim + get(mpslaboursalesCostMarginDict, each) + colDelim; 		
}
for each in itslaboursalesCostMarginArr {
	itslabourpimaArrayString = itslabourpimaArrayString + each + rowDelim + get(itslaboursalesCostMarginDict, each) + colDelim; 
		
}
for each in tasslabooursalesCostMarginArr {
	tasslabourpimaArrayString = tasslabourpimaArrayString + each + rowDelim + get(tasslaboursalesCostMarginDict, each) + colDelim; 
		
	index = index + 1;
}
for each in mslaboursalesCostMarginArr {
	mslabourpimaArrayString = mslabourpimaArrayString + each + rowDelim + get(mslaboursalesCostMarginDict, each) + colDelim; 			
}
if(len(mpslabourpimaArrayString) > len(colDelim)){
	mpslabourpimaArrayString = substring(mpslabourpimaArrayString, 0, len(mpslabourpimaArrayString) - len(colDelim));
}
if(len(itslabourpimaArrayString) > len(colDelim)){
	itslabourpimaArrayString = substring(itslabourpimaArrayString, 0, len(itslabourpimaArrayString) - len(colDelim));
}
if(len(tasslabourpimaArrayString) > len(colDelim)){
	tasslabourpimaArrayString = substring(tasslabourpimaArrayString, 0, len(tasslabourpimaArrayString) - len(colDelim));
}
if(len(mslabourpimaArrayString) > len(colDelim)){
	mslabourpimaArrayString = substring(mslabourpimaArrayString, 0, len(mslabourpimaArrayString) - len(colDelim));
}
res = res + "1~mSlaborPIMADescriptionArrayString_c~" + mslabourpimaArrayString + "|";
res = res + "1~mPSlaborPIMADescriptionArrayString_c~" + mpslabourpimaArrayString + "|";
res = res + "1~tASSPIMADescriptionArrayString_c~" + tasslabourpimaArrayString + "|";
res = res + "1~iTSPIMADescriptionArrayString_c~" + itslabourpimaArrayString + "|";
index = 1;
mslabourretTempVal = "";
mslabourmarginFactor  = 0.0;
mslaboutyearDict = dict("float");

if(mslabourpimaArrayString <> ""){
	mslabourpimaArrayRow = split(mslabourpimaArrayString, colDelim);
	for mslabourpimaArray in mslabourpimaArrayRow {
		msyearVal = split(mslabourpimaArray, rowDelim);
		if(isnumber(msyearVal[1])){
		mslabourmarginFactor = atof(msyearVal[1]);
		}
		msyear =(msyearVal[0]);
		if(mslabourmarginFactor<18.00){
				put(mslaboutyearDict, msyear,mslabourmarginFactor);
	}
	index = index + 1;
	}
}
mslabouryearArray = keys(mslaboutyearDict);
for each in mslabouryearArray {
	if(each <> ""){
		mslabourretTempVal = mslabourretTempVal + each + rowDelim + string(get(mslaboutyearDict, each)) + colDelim ;
	}
}
index = 1;
mpslabourretTempVal = "";
mpslabourmarginFactor  = 0.0;
mpslabouryearDict = dict("float");
if(mpslabourpimaArrayString<> ""){
	mpslabourpimaArrayRow = split(mpslabourpimaArrayString, colDelim);
	for mpslabourpimaArray in mpslabourpimaArrayRow {
		mpsyearVal = split(mpslabourpimaArray, rowDelim);
		if(isnumber(mpsyearVal[1])){
		mpslabourmarginFactor = atof(mpsyearVal[1]);
		}
		mpsyear = (mpsyearVal[0]);
		if(mpslabourmarginFactor<18.00){
				put(mpslabouryearDict,mpsyear,mpslabourmarginFactor);
	}
	index = index + 1;
	}
}
mpslabouryearArray = keys(mpslabouryearDict);
for each in mpslabouryearArray {
	if(each <> ""){
		mpslabourretTempVal = mpslabourretTempVal + each + rowDelim + string(get(mpslabouryearDict, each)) + colDelim ;
	}
}
index=1;
tasslabourretTempVal = "";
tasslabourmarginFactor  = 0.0;
tasslabouryearDict = dict("float");
if(tasslabourpimaArrayString <> ""){
	tasslabourpimaArrayRow = split(tasslabourpimaArrayString, colDelim);
	for tasslabourpimaArray in tasslabourpimaArrayRow {
		tassyearVal = split(tasslabourpimaArray, rowDelim);
		if(isnumber(tassyearVal[1])){
		tasslabourmarginFactor = atof(tassyearVal[1]);
		}
		tassyear = (tassyearVal[0]);
		if(tasslabourmarginFactor<18.00){
				put(tasslabouryearDict,tassyear,tasslabourmarginFactor);
	}
	index = index + 1;
	}
}
tasslabouryearArray = keys(tasslabouryearDict);
for each in tasslabouryearArray {
	if(each <> ""){
		tasslabourretTempVal = tasslabourretTempVal + each + rowDelim + string(get(tasslabouryearDict, each)) + colDelim ;
	}
}
index=1;
itslabourretTempVal = "";
itslabourmarginFactor  = 0.0;
itslabouryearDict = dict("float");
if(itslabourpimaArrayString <> ""){
	itslabourpimaArrayRow = split(itslabourpimaArrayString, colDelim);
	for itslabourpimaArray in itslabourpimaArrayRow {
		itsyearVal = split(itslabourpimaArray, rowDelim);
		if(isnumber(itsyearVal[1])){
		itslabourmarginFactor = atof(itsyearVal[1]);
		}
		itsyear = (itsyearVal[0]);
		if(itslabourmarginFactor<18.00){
				put(itslabouryearDict,itsyear,itslabourmarginFactor);
	}
	index = index + 1;
	}
}
itslabouryearArray = keys(itslabouryearDict);
for each in itslabouryearArray {
	if(each <> ""){
		itslabourretTempVal = itslabourretTempVal + each + rowDelim + string(get(itslabouryearDict, each)) + colDelim ;
	}
}


res = res + "1~tassLabourYearsBreached_t_c~" + tasslabourretTempVal + "|";
res = res + "1~iTSLabourYearsBreached_t_c~" + itslabourretTempVal + "|";
res = res + "1~mpsLabourYearsBreached_t_c~" + mpslabourretTempVal + "|";
res = res + "1~msLabourYearsBreached_t_c~" + mslabourretTempVal + "|";
//END_CPQ_BAU_CHG0087174_CREATED_BY_gowtham_01-11-2024

if((totalMarginPercent1 > 18.0 AND totalMarginPercent1 <= 20.0) OR (totalMarginPercent2 > 18.0 AND totalMarginPercent2 <= 20.0) OR (totalMarginPercent3 > 18.0 AND totalMarginPercent3 <= 20.0) OR (totalMarginPercent4 > 18.0 AND totalMarginPercent4 <= 20.0) OR (totalMarginPercent5 > 18.0 AND totalMarginPercent5 <= 20.0) OR (totalMarginPercent6 > 18.0 AND totalMarginPercent6 <= 20.0) OR (totalMarginPercent7 > 18.0 AND totalMarginPercent7 <= 20.0)){
	
GPMessageforFnF	= "Quote contains GP in the PIMA Report that is >18% and <=20%";
	
}

if((year1Flag AND totalMarginPercent1 <= 18.0) OR (year2Flag AND totalMarginPercent2 <= 18.0) OR (year3Flag AND totalMarginPercent3 <= 18.0) OR (year4Flag AND totalMarginPercent4 <= 18.0) OR (year5Flag AND totalMarginPercent5 <= 18.0) OR (year6Flag AND totalMarginPercent6 <= 18.0) OR (year7Flag AND totalMarginPercent7 <= 18.0)){
	
GPMessageforFnF	= GPMessageforFnF + "#$#Quote contains GP in the PIMA Report that is <=18%";
}

//Start_HYPERCARE-CR_CHG#0082000_CR#41_Description_by Namrata
if(variableAnnualRevenueEscalation_t== false){
annualRevenueEscalationJson = json();
annualEscalationBuild = jsonarray();
value = 0;
jsonput(annualRevenueEscalationJson , "year1", string(value));
jsonput(annualRevenueEscalationJson , "year2",string(value));
jsonput(annualRevenueEscalationJson , "year3", string(value));
jsonput(annualRevenueEscalationJson , "year4",string(value));
jsonput(annualRevenueEscalationJson , "year5", string(value));
jsonput(annualRevenueEscalationJson , "year6", string(value));
jsonput(annualRevenueEscalationJson , "year7", string(value));
jsonarrayappend(annualEscalationBuild, annualRevenueEscalationJson );
//print 	annualEscalationBuild	;		
res = res + "1~variableAnnualEscalationArraySet_t~" + jsonarrayrefid(annualEscalationBuild) + "|";
}
//END_HYPERCARE-CR_CHG#0082000_CR#41_Description_by Namrata
// returning Data to all the Array sets
res = res + "1~mSTotalDealSectionArray_t~" + jsonarrayrefid(MSTotalDealArray) + "|";
res = res + "1~firstMonthBillingArraySet_t~" + jsonarrayrefid(firstMonthBillingArray) + "|";

res = res + "1~mSlaborPIMADescriptionArray_t~" + jsonarrayrefid(MSPIMAArray) + "|";
res = res + "1~mPSlaborPIMADescriptionArray_t~" + jsonarrayrefid(MPSPIMAArray) + "|";
res = res + "1~iTSPIMADescriptionArray_t~" + jsonarrayrefid(ITSPIMAArray) + "|";
res = res + "1~tASSPIMADescriptionArray_t~" + jsonarrayrefid(TASSPIMAArray) + "|";
res = res + "1~vehiclePIMADescriptionArray_t~" + jsonarrayrefid(VehiclePIMAArray) + "|";
res = res + "1~tRACPIMADescriptionArray_t~" + jsonarrayrefid(TRACPIMAArray) + "|";
res = res + "1~otherSerPIMADescriptionArray_t~" + jsonarrayrefid(OtherSerPIMAArray) + "|";
res = res + "1~otherSerNTPIMA_Array~" + jsonarrayrefid(OtherSerNTPIMAArray) + "|";
res = res + "1~pSPIMADescriptionArray_t~" + jsonarrayrefid(PSPIMAArray) + "|";
res = res + "1~mailRoomPIMADescriptionArray_t~" + jsonarrayrefid(mailRoomPIMAArray) + "|";
res = res + "1~rebateArray_t~" + jsonarrayrefid(rebateTotalArray) + "|";
res = res + "1~areaCostArray_t~" + jsonarrayrefid(areaCostArray) + "|";
res = res + "1~mSDealMarginYear1_t~" + string(totalMarginPercent1) + "|";
res = res + "1~mSDealMarginYear2_t~" + string(totalMarginPercent2) + "|";
res = res + "1~mSDealMarginYear3_t~" + string(totalMarginPercent3)+ "|";
res = res + "1~mSDealMarginYear4_t~" + string(totalMarginPercent4) + "|";
res = res + "1~mSDealMarginYear5_t~" + string(totalMarginPercent5) + "|";
res = res + "1~mSDealMarginYear6_t~" + string(totalMarginPercent6) + "|";
res = res + "1~mSDealMarginYear7_t~" + string(totalMarginPercent7) + "|";
res = res + "1~gPMessageForFnF_t~" + GPMessageforFnF + "|";
res = res + "1~a1stMonthPaymentPIMA_t~" + string(FirstMonthPaymentPIMA)+ "|";
res = res + "1~a1stYearPIMAGP_t~" + string(FirstYearPIMAGP)+ "|";

// GP Level update


res = res + "1~pricingGPThreshold_Year1_t~" + pricingThresholdBreachY1+ "|";
res = res + "1~pricingGPThreshold_Year2_t~" + pricingThresholdBreachY2+ "|";
res = res + "1~pricingGPThreshold_Year3_t~" + pricingThresholdBreachY3+ "|";
res = res + "1~pricingGPThreshold_Year4_t~" + pricingThresholdBreachY4+ "|";
res = res + "1~pricingGPThreshold_Year5_t~" + pricingThresholdBreachY5+ "|";
res = res + "1~pricingGPThreshold_Year6_t~" + pricingThresholdBreachY6+ "|";
res = res + "1~pricingGPThreshold_Year7_t~" + pricingThresholdBreachY7+ "|";
res = res + "1~pricingGPLevel_Description_t~" + "Pricing Threshold Breach"+ "|";
//res = res + "1~pIMADate_t~" + _system_date+ "|";
res = res + "1~pIMADate_t~" + ("PIMA generation" + " " + datetostr(getdate(true), "MM/dd/YYYY, HH:MM", _system_user_time_zone) + "ET")+ "|";

return res;